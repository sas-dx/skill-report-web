# ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆå®Ÿè£…ã‚¬ã‚¤ãƒ‰: å¹´é–“ã‚¹ã‚­ãƒ«å ±å‘Šæ›¸WEBåŒ–PJT

---

## 1. æ–‡æ›¸æƒ…å ±

| é …ç›® | å†…å®¹ |
|------|------|
| æ–‡æ›¸å | ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆå®Ÿè£…ã‚¬ã‚¤ãƒ‰ï¼ˆçµ±åˆç‰ˆï¼‰ |
| ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå | å¹´é–“ã‚¹ã‚­ãƒ«å ±å‘Šæ›¸WEBåŒ–ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ |
| ã‚·ã‚¹ãƒ†ãƒ å | ã‚¹ã‚­ãƒ«å ±å‘Šæ›¸ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ï¼ˆSRMSï¼‰ |
| ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆID | SAS-DX-AI-2025-001 |
| ä½œæˆè€… | AIæ¨é€²ãƒãƒ¼ãƒ  |
| ä½œæˆæ—¥ | 2025å¹´5æœˆ29æ—¥ |
| æœ€çµ‚æ›´æ–°æ—¥ | 2025å¹´6æœˆ2æ—¥ |
| ç‰ˆæ•° | 2.0 |

---

## 2. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆã®æ¦‚è¦

### 2.1 ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆã®ç›®çš„

ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆã¯ã€Next.js + PostgreSQL + Vercel æ§‹æˆã®ã‚·ã‚¹ãƒ†ãƒ ã®æ€§èƒ½ç‰¹æ€§ã‚’æ¸¬å®šãƒ»è©•ä¾¡ã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ã‚¯ã‚¹ãƒšãƒªã‚¨ãƒ³ã‚¹ã®å‘ä¸Šã¨ã‚·ã‚¹ãƒ†ãƒ ã®å®‰å®šæ€§ç¢ºä¿ã‚’ç›®çš„ã¨ã—ã¾ã™ã€‚

#### ä¸»ãªæ¤œè¨¼é …ç›®
- **ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“**: Next.js ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚é–“ã€API Routes å¿œç­”æ™‚é–“
- **ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆ**: åŒæ™‚æ¥ç¶šæ•°ã€å‡¦ç†èƒ½åŠ›
- **ãƒªã‚½ãƒ¼ã‚¹ä½¿ç”¨é‡**: CPUã€ãƒ¡ãƒ¢ãƒªã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä½¿ç”¨ç‡
- **ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£**: Vercel ã§ã®è² è·å¢—åŠ æ™‚ã®æ€§èƒ½å¤‰åŒ–
- **å®‰å®šæ€§**: é•·æ™‚é–“é‹ç”¨æ™‚ã®æ€§èƒ½ç¶­æŒ

### 2.2 ãƒ†ã‚¹ãƒˆå¯¾è±¡ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆ

```mermaid
graph TD
    A[Next.js Frontend] --> B[API Routes]
    B --> C[Prisma ORM]
    C --> D[PostgreSQL]
    A --> E[Vercel Edge Network]
    E --> F[CDN Cache]
    B --> G[NextAuth.js]
    G --> H[JWT Session]
    
    subgraph "Performance Test Coverage"
        I[Page Load Performance]
        J[API Response Time]
        K[Database Query Performance]
        L[Authentication Performance]
        M[File Upload Performance]
    end
    
    I --> A
    J --> B
    K --> C
    L --> G
    M --> B
```

### 2.3 æ€§èƒ½è¦ä»¶ï¼ˆãƒ†ã‚¹ãƒˆè¨­è¨ˆæ›¸æº–æ‹ ï¼‰

| é …ç›® | ç›®æ¨™å€¤ | è¨±å®¹å€¤ | æ¸¬å®šæ–¹æ³• |
|------|--------|--------|----------|
| ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚é–“ | 1ç§’ä»¥å†… | 2ç§’ä»¥å†… | Lighthouse, Web Vitals |
| APIå¿œç­”æ™‚é–“ | 500msä»¥å†… | 1ç§’ä»¥å†… | K6, Artillery |
| åŒæ™‚æ¥ç¶šãƒ¦ãƒ¼ã‚¶ãƒ¼æ•° | 100ãƒ¦ãƒ¼ã‚¶ãƒ¼ | 150ãƒ¦ãƒ¼ã‚¶ãƒ¼ | è² è·ãƒ†ã‚¹ãƒˆ |
| First Contentful Paint | 1.8ç§’ä»¥å†… | 3ç§’ä»¥å†… | Lighthouse |
| Largest Contentful Paint | 2.5ç§’ä»¥å†… | 4ç§’ä»¥å†… | Web Vitals |
| Cumulative Layout Shift | 0.1ä»¥ä¸‹ | 0.25ä»¥ä¸‹ | Web Vitals |

---

## 3. ãƒ†ã‚¹ãƒˆç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### 3.1 å¿…è¦ãƒ„ãƒ¼ãƒ«ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
# Next.js ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç”¨ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«
npm install -D @playwright/test
npm install -D lighthouse
npm install -D web-vitals
npm install -D @axe-core/playwright

# K6ï¼ˆè² è·ãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«ï¼‰ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
# macOS
brew install k6

# Ubuntu/Debian
sudo gpg -k
sudo gpg --no-default-keyring --keyring /usr/share/keyrings/k6-archive-keyring.gpg --keyserver hkp://keyserver.ubuntu.com:80 --recv-keys C5AD17C747E3415A3642D57D77C6C491D6AC1D69
echo "deb [signed-by=/usr/share/keyrings/k6-archive-keyring.gpg] https://dl.k6.io/deb stable main" | sudo tee /etc/apt/sources.list.d/k6.list
sudo apt-get update
sudo apt-get install k6

# Windows
choco install k6

# Artilleryï¼ˆè² è·ãƒ†ã‚¹ãƒˆï¼‰
npm install -g artillery

# Clinic.jsï¼ˆNode.jsãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨ºæ–­ï¼‰
npm install -g clinic

# Autocannonï¼ˆHTTPè² è·ãƒ†ã‚¹ãƒˆï¼‰
npm install -g autocannon
```

### 3.2 Next.js ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–è¨­å®š

#### next.config.js è¨­å®š
```javascript
/** @type {import('next').NextConfig} */
const nextConfig = {
  // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–è¨­å®š
  experimental: {
    instrumentationHook: true,
    serverComponentsExternalPackages: ['@prisma/client']
  },
  
  // ç”»åƒæœ€é©åŒ–
  images: {
    formats: ['image/webp', 'image/avif'],
    deviceSizes: [640, 750, 828, 1080, 1200, 1920, 2048, 3840],
    imageSizes: [16, 32, 48, 64, 96, 128, 256, 384]
  },
  
  // ãƒãƒ³ãƒ‰ãƒ«åˆ†æ
  webpack: (config, { dev, isServer }) => {
    if (!dev && !isServer) {
      config.optimization.splitChunks = {
        chunks: 'all',
        cacheGroups: {
          vendor: {
            test: /[\\/]node_modules[\\/]/,
            name: 'vendors',
            chunks: 'all'
          }
        }
      }
    }
    return config
  },
  
  // ãƒ˜ãƒƒãƒ€ãƒ¼è¨­å®šï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥æœ€é©åŒ–ï¼‰
  async headers() {
    return [
      {
        source: '/(.*)',
        headers: [
          {
            key: 'X-Content-Type-Options',
            value: 'nosniff'
          },
          {
            key: 'X-Frame-Options',
            value: 'DENY'
          }
        ]
      },
      {
        source: '/api/(.*)',
        headers: [
          {
            key: 'Cache-Control',
            value: 'public, max-age=60, stale-while-revalidate=300'
          }
        ]
      }
    ]
  }
}

module.exports = nextConfig
```

---

## 4. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ

### 4.1 Next.js Lighthouse ãƒ†ã‚¹ãƒˆ

#### tests/performance/lighthouse-nextjs.js
```javascript
const lighthouse = require('lighthouse')
const chromeLauncher = require('chrome-launcher')
const fs = require('fs')
const path = require('path')

class NextJSPerformanceTest {
  constructor(baseUrl = 'http://localhost:3000') {
    this.baseUrl = baseUrl
    this.results = []
  }

  async runLighthouseTest(url, options = {}) {
    const chrome = await chromeLauncher.launch({ 
      chromeFlags: ['--headless', '--no-sandbox', '--disable-dev-shm-usage'] 
    })
    
    const opts = {
      logLevel: 'info',
      output: 'json',
      onlyCategories: ['performance'],
      port: chrome.port,
      formFactor: 'desktop',
      throttling: {
        rttMs: 40,
        throughputKbps: 10240,
        cpuSlowdownMultiplier: 1,
        requestLatencyMs: 0,
        downloadThroughputKbps: 0,
        uploadThroughputKbps: 0
      },
      ...options
    }

    const runnerResult = await lighthouse(url, opts)
    await chrome.kill()

    return runnerResult
  }

  async testNextJSPages() {
    const pages = [
      { path: '/', name: 'Home' },
      { path: '/auth/signin', name: 'Sign In' },
      { path: '/dashboard', name: 'Dashboard', requiresAuth: true },
      { path: '/skills', name: 'Skills Management', requiresAuth: true },
      { path: '/profile', name: 'Profile', requiresAuth: true },
      { path: '/reports', name: 'Reports', requiresAuth: true }
    ]

    console.log('ğŸš€ Starting Next.js Performance Tests...')

    for (const page of pages) {
      const url = `${this.baseUrl}${page.path}`
      console.log(`\nğŸ“Š Testing ${page.name} (${url})...`)

      try {
        const result = await this.runLighthouseTest(url)
        const metrics = this.extractMetrics(result.lhr, page)
        
        this.results.push(metrics)
        this.logMetrics(metrics)
        
        // è©³ç´°ãƒ¬ãƒãƒ¼ãƒˆã‚’ä¿å­˜
        const reportHtml = result.report
        const fileName = `lighthouse-${page.name.toLowerCase().replace(/\s+/g, '-')}.html`
        fs.writeFileSync(path.join('./test-results', fileName), reportHtml)
        
      } catch (error) {
        console.error(`âŒ Error testing ${page.name}:`, error.message)
      }
    }

    this.generateSummaryReport()
  }

  extractMetrics(lhr, page) {
    return {
      page: page.name,
      url: page.path,
      timestamp: new Date().toISOString(),
      
      // Core Web Vitals
      performanceScore: Math.round(lhr.categories.performance.score * 100),
      firstContentfulPaint: lhr.audits['first-contentful-paint'].numericValue,
      largestContentfulPaint: lhr.audits['largest-contentful-paint'].numericValue,
      cumulativeLayoutShift: lhr.audits['cumulative-layout-shift'].numericValue,
      totalBlockingTime: lhr.audits['total-blocking-time'].numericValue,
      
      // Next.js ç‰¹æœ‰ã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹
      speedIndex: lhr.audits['speed-index'].numericValue,
      timeToInteractive: lhr.audits['interactive'].numericValue,
      firstMeaningfulPaint: lhr.audits['first-meaningful-paint'].numericValue,
      
      // ãƒªã‚½ãƒ¼ã‚¹æƒ…å ±
      totalByteWeight: lhr.audits['total-byte-weight'].numericValue,
      unusedJavaScript: lhr.audits['unused-javascript']?.numericValue || 0,
      unusedCSSRules: lhr.audits['unused-css-rules']?.numericValue || 0,
      
      // Next.js ãƒãƒ³ãƒ‰ãƒ«åˆ†æ
      mainThreadWorkBreakdown: lhr.audits['mainthread-work-breakdown'].details?.items || [],
      networkRequests: lhr.audits['network-requests'].details?.items?.length || 0
    }
  }

  logMetrics(metrics) {
    console.log(`  ğŸ“ˆ Performance Score: ${metrics.performanceScore}/100`)
    console.log(`  âš¡ First Contentful Paint: ${Math.round(metrics.firstContentfulPaint)}ms`)
    console.log(`  ğŸ¯ Largest Contentful Paint: ${Math.round(metrics.largestContentfulPaint)}ms`)
    console.log(`  ğŸ“ Cumulative Layout Shift: ${metrics.cumulativeLayoutShift.toFixed(3)}`)
    console.log(`  â±ï¸  Total Blocking Time: ${Math.round(metrics.totalBlockingTime)}ms`)
    console.log(`  ğŸ“¦ Total Byte Weight: ${Math.round(metrics.totalByteWeight / 1024)}KB`)
    
    // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è©•ä¾¡
    this.evaluatePerformance(metrics)
  }

  evaluatePerformance(metrics) {
    const issues = []
    
    if (metrics.performanceScore < 90) {
      issues.push(`âš ï¸  Performance score is below 90: ${metrics.performanceScore}`)
    }
    
    if (metrics.firstContentfulPaint > 1800) {
      issues.push(`âš ï¸  FCP is slow: ${Math.round(metrics.firstContentfulPaint)}ms`)
    }
    
    if (metrics.largestContentfulPaint > 2500) {
      issues.push(`âš ï¸  LCP is slow: ${Math.round(metrics.largestContentfulPaint)}ms`)
    }
    
    if (metrics.cumulativeLayoutShift > 0.1) {
      issues.push(`âš ï¸  CLS is high: ${metrics.cumulativeLayoutShift.toFixed(3)}`)
    }
    
    if (metrics.totalBlockingTime > 300) {
      issues.push(`âš ï¸  TBT is high: ${Math.round(metrics.totalBlockingTime)}ms`)
    }

    if (issues.length > 0) {
      console.log('  ğŸ” Issues found:')
      issues.forEach(issue => console.log(`    ${issue}`))
    } else {
      console.log('  âœ… All metrics within acceptable ranges')
    }
  }

  generateSummaryReport() {
    const summary = {
      testDate: new Date().toISOString(),
      totalPages: this.results.length,
      averagePerformanceScore: this.results.reduce((sum, r) => sum + r.performanceScore, 0) / this.results.length,
      results: this.results,
      recommendations: this.generateRecommendations()
    }

    fs.writeFileSync('./test-results/lighthouse-summary.json', JSON.stringify(summary, null, 2))
    
    console.log('\nğŸ“‹ Performance Test Summary:')
    console.log(`  ğŸ“Š Average Performance Score: ${Math.round(summary.averagePerformanceScore)}/100`)
    console.log(`  ğŸ“„ Pages Tested: ${summary.totalPages}`)
    console.log(`  ğŸ“ Detailed reports saved to: ./test-results/`)
  }

  generateRecommendations() {
    const recommendations = []
    
    // å…±é€šçš„ãªæœ€é©åŒ–ææ¡ˆ
    const avgFCP = this.results.reduce((sum, r) => sum + r.firstContentfulPaint, 0) / this.results.length
    if (avgFCP > 1800) {
      recommendations.push({
        issue: 'Slow First Contentful Paint',
        suggestion: 'Consider implementing Next.js Image optimization and reducing initial bundle size'
      })
    }

    const avgLCP = this.results.reduce((sum, r) => sum + r.largestContentfulPaint, 0) / this.results.length
    if (avgLCP > 2500) {
      recommendations.push({
        issue: 'Slow Largest Contentful Paint',
        suggestion: 'Optimize images with next/image and implement proper loading strategies'
      })
    }

    const avgCLS = this.results.reduce((sum, r) => sum + r.cumulativeLayoutShift, 0) / this.results.length
    if (avgCLS > 0.1) {
      recommendations.push({
        issue: 'High Cumulative Layout Shift',
        suggestion: 'Add explicit dimensions to images and reserve space for dynamic content'
      })
    }

    return recommendations
  }
}

// å®Ÿè¡Œ
async function runPerformanceTests() {
  const tester = new NextJSPerformanceTest()
  await tester.testNextJSPages()
}

if (require.main === module) {
  runPerformanceTests().catch(console.error)
}

module.exports = NextJSPerformanceTest
```

---

## 5. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ

### 5.1 Next.js API Routes + Prisma è² è·ãƒ†ã‚¹ãƒˆ

#### tests/performance/k6-nextjs-api.js
```javascript
import http from 'k6/http'
import { check, sleep } from 'k6'
import { Rate, Trend, Counter } from 'k6/metrics'

// ã‚«ã‚¹ã‚¿ãƒ ãƒ¡ãƒˆãƒªã‚¯ã‚¹
const errorRate = new Rate('errors')
const authDuration = new Trend('auth_duration')
const apiResponseTime = new Trend('api_response_time')
const dbQueryTime = new Trend('db_query_time')
const prismaOperations = new Counter('prisma_operations')

// Next.js API Routes ãƒ†ã‚¹ãƒˆè¨­å®š
export const options = {
  stages: [
    { duration: '2m', target: 10 },   // ã‚¦ã‚©ãƒ¼ãƒ ã‚¢ãƒƒãƒ—
    { duration: '5m', target: 25 },   // é€šå¸¸è² è·
    { duration: '3m', target: 50 },   // é«˜è² è·
    { duration: '2m', target: 100 },  // ãƒ”ãƒ¼ã‚¯è² è·
    { duration: '3m', target: 0 },    // ã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³
  ],
  thresholds: {
    http_req_duration: ['p(95)<1000'],  // 95%ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒ1ç§’ä»¥å†…
    http_req_failed: ['rate<0.01'],     // ã‚¨ãƒ©ãƒ¼ç‡1%æœªæº€
    errors: ['rate<0.01'],
    api_response_time: ['p(95)<500'],    // APIå¿œç­”æ™‚é–“
    auth_duration: ['p(95)<200'],        // èªè¨¼æ™‚é–“
  }
}

// ãƒ†ã‚¹ãƒˆç”¨èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³
let authToken = null

// ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—é–¢æ•°
export function setup() {
  // ãƒ†ã‚¹ãƒˆç”¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã§ãƒ­ã‚°ã‚¤ãƒ³
  const loginResponse = http.post(`${__ENV.BASE_URL || 'http://localhost:3000'}/api/auth/signin`, {
    email: 'test@example.com',
    password: 'password123'
  })
  
  if (loginResponse.status === 200) {
    const authData = JSON.parse(loginResponse.body)
    return { token: authData.token }
  }
  
  throw new Error('Authentication failed in setup')
}

// ãƒ¡ã‚¤ãƒ³ãƒ†ã‚¹ãƒˆé–¢æ•°
export default function(data) {
  const baseUrl = __ENV.BASE_URL || 'http://localhost:3000'
  const headers = {
    'Content-Type': 'application/json',
    'Authorization': `Bearer ${data.token}`
  }

  // 1. ã‚¹ã‚­ãƒ«ä¸€è¦§å–å¾—ãƒ†ã‚¹ãƒˆ
  testSkillsList(baseUrl, headers)
  
  // 2. ã‚¹ã‚­ãƒ«ä½œæˆãƒ†ã‚¹ãƒˆ
  testSkillCreation(baseUrl, headers)
  
  // 3. ã‚¹ã‚­ãƒ«æ›´æ–°ãƒ†ã‚¹ãƒˆ
  testSkillUpdate(baseUrl, headers)
  
  // 4. ã‚¹ã‚­ãƒ«æ¤œç´¢ãƒ†ã‚¹ãƒˆ
  testSkillSearch(baseUrl, headers)
  
  // 5. ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å–å¾—ãƒ†ã‚¹ãƒˆ
  testProfileRetrieval(baseUrl, headers)
  
  sleep(1)
}

function testSkillsList(baseUrl, headers) {
  const start = Date.now()
  const response = http.get(`${baseUrl}/api/skills`, { headers })
  const duration = Date.now() - start
  
  apiResponseTime.add(duration)
  prismaOperations.add(1)
  
  const success = check(response, {
    'skills list status is 200': (r) => r.status === 200,
    'skills list response time < 500ms': (r) => r.timings.duration < 500,
    'skills list has data': (r) => {
      try {
        const data = JSON.parse(r.body)
        return Array.isArray(data.skills)
      } catch {
        return false
      }
    }
  })
  
  if (!success) {
    errorRate.add(1)
  }
}

function testSkillCreation(baseUrl, headers) {
  const skillData = {
    name: `Test Skill ${Math.random().toString(36).substr(2, 9)}`,
    category: 'ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èª',
    level: 3,
    experience: '2å¹´',
    description: 'K6è² è·ãƒ†ã‚¹ãƒˆç”¨ã®ãƒ†ã‚¹ãƒˆã‚¹ã‚­ãƒ«'
  }
  
  const start = Date.now()
  const response = http.post(`${baseUrl}/api/skills`, JSON.stringify(skillData), { headers })
  const duration = Date.now() - start
  
  apiResponseTime.add(duration)
  prismaOperations.add(1)
  
  const success = check(response, {
    'skill creation status is 201': (r) => r.status === 201,
    'skill creation response time < 1000ms': (r) => r.timings.duration < 1000,
    'skill creation returns id': (r) => {
      try {
        const data = JSON.parse(r.body)
        return data.skill && data.skill.id
      } catch {
        return false
      }
    }
  })
  
  if (!success) {
    errorRate.add(1)
  }
}

function testSkillUpdate(baseUrl, headers) {
  // æ—¢å­˜ã‚¹ã‚­ãƒ«ã‚’å–å¾—
  const listResponse = http.get(`${baseUrl}/api/skills`, { headers })
  if (listResponse.status !== 200) return
  
  const skills = JSON.parse(listResponse.body).skills
  if (skills.length === 0) return
  
  const skillToUpdate = skills[0]
  const updateData = {
    ...skillToUpdate,
    level: (skillToUpdate.level % 4) + 1,
    description: `Updated at ${new Date().toISOString()}`
  }
  
  const start = Date.now()
  const response = http.put(`${baseUrl}/api/skills/${skillToUpdate.id}`, JSON.stringify(updateData), { headers })
  const duration = Date.now() - start
  
  apiResponseTime.add(duration)
  prismaOperations.add(1)
  
  const success = check(response, {
    'skill update status is 200': (r) => r.status === 200,
    'skill update response time < 800ms': (r) => r.timings.duration < 800
  })
  
  if (!success) {
    errorRate.add(1)
  }
}

function testSkillSearch(baseUrl, headers) {
  const searchParams = [
    'category=ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èª',
    'level=3',
    'keyword=JavaScript',
    'sort=name'
  ]
  
  const queryString = searchParams.join('&')
  
  const start = Date.now()
  const response = http.get(`${baseUrl}/api/skills/search?${queryString}`, { headers })
  const duration = Date.now() - start
  
  apiResponseTime.add(duration)
  prismaOperations.add(1)
  
  const success = check(response, {
    'skill search status is 200': (r) => r.status === 200,
    'skill search response time < 600ms': (r) => r.timings.duration < 600,
    'skill search returns results': (r) => {
      try {
        const data = JSON.parse(r.body)
        return Array.isArray(data.results)
      } catch {
        return false
      }
    }
  })
  
  if (!success) {
    errorRate.add(1)
  }
}

function testProfileRetrieval(baseUrl, headers) {
  const start = Date.now()
  const response = http.get(`${baseUrl}/api/profile`, { headers })
  const duration = Date.now() - start
  
  apiResponseTime.add(duration)
  prismaOperations.add(1)
  
  const success = check(response, {
    'profile retrieval status is 200': (r) => r.status === 200,
    'profile retrieval response time < 300ms': (r) => r.timings.duration < 300,
    'profile has user data': (r) => {
      try {
        const data = JSON.parse(r.body)
        return data.user && data.user.id
      } catch {
        return false
      }
    }
  })
  
  if (!success) {
    errorRate.add(1)
  }
}

// èªè¨¼ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ
export function testAuthentication() {
  const baseUrl = __ENV.BASE_URL || 'http://localhost:3000'
  
  const start = Date.now()
  const response = http.post(`${baseUrl}/api/auth/signin`, {
    email: 'test@example.com',
    password: 'password123'
  })
  const duration = Date.now() - start
  
  authDuration.add(duration)
  
  check(response, {
    'auth status is 200': (r) => r.status === 200,
    'auth response time < 200ms': (r) => r.timings.duration < 200
  })
}
```

---

## 6. ãƒ†ã‚¹ãƒˆå®Ÿè¡Œãƒ»ãƒ¬ãƒãƒ¼ãƒˆ

### 6.1 ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚¹ã‚¯ãƒªãƒ—ãƒˆ

#### package.json è¨­å®š
```json
{
  "scripts": {
    "test:performance": "npm run test:performance:frontend && npm run test:performance:backend",
    "test:performance:frontend": "npm run test:lighthouse && npm run test:web-vitals",
    "test:performance:backend": "npm run test:k6 && npm run test:database",
    
    "test:lighthouse": "node tests/performance/lighthouse-nextjs.js",
    "test:web-vitals": "node tests/performance/web-vitals-nextjs.js",
    "test:k6": "k6 run tests/performance/k6-nextjs-api.js",
    "test:database": "node tests/performance/database-performance.js",
    
    "test:performance:ci": "npm run test:performance -- --reporter=json",
    "test:performance:report": "node scripts/generate-performance-report.js"
  }
}
```

### 6.2 CI/CDçµ±åˆ

#### .github/workflows/performance-tests.yml
```yaml
name: Performance Tests

on:
  schedule:
    - cron: '0 2 * * *'  # æ¯æ—¥åˆå‰2æ™‚ã«å®Ÿè¡Œ
  workflow_dispatch:

jobs:
  performance-tests:
    runs-on: ubuntu-latest
    
    services:
      postgres:
        image: postgres:15
        env:
          POSTGRES_PASSWORD: test_password
          POSTGRES_USER: test_user
          POSTGRES_DB: srms_test
        options: >-
          --health-cmd pg_isready
          --health-interval 10s
          --health-timeout 5s
          --health-retries 5
        ports:
          - 5433:5432
    
    steps:
    - uses: actions/checkout@v3
    
    - uses: actions/setup-node@v3
      with:
        node-version: 18
        cache: 'npm'
    
    - name: Install dependencies
      run: npm ci
    
    - name: Install K6
      run: |
        sudo gpg -k
        sudo gpg --no-default-keyring --keyring /usr/share/keyrings/k6-archive-keyring.gpg --keyserver hkp://keyserver.ubuntu.com:80 --recv-keys C5AD17C747E3415A3642D57D77C6C491D6AC1D69
        echo "deb [signed-by=/usr/share/keyrings/k6-archive-keyring.gpg] https://dl.k6.io/deb stable main" | sudo tee /etc/apt/sources.list.d/k6.list
        sudo apt-get update
        sudo apt-get install k6
    
    - name: Setup test database
      run: |
        npm run db:migrate:test
        npm run db:seed:test
      env:
        DATABASE_URL: postgresql://test_user:test_password@localhost:5433/srms_test
    
    - name: Start Next.js application
      run: |
        npm run build
        npm start &
        sleep 30
      env:
        DATABASE_URL: postgresql://test_user:test_password@localhost:5433/srms_test
        NEXTAUTH_SECRET: test-secret-key
    
    - name: Run Performance Tests
      run: npm run test:performance:ci
      env:
        BASE_URL: http://localhost:3000
        DATABASE_URL: postgresql://test_user:test_password@localhost:5433/srms_test
    
    - name: Generate Performance Report
      run: npm run test:performance:report
    
    - uses: actions/upload-artifact@v3
      with:
        name: performance-report
        path: test-results/
        retention-days: 30
```

---

## 7. ã¾ã¨ã‚

### 7.1 ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆã®ä¾¡å€¤

- **ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ã‚¯ã‚¹ãƒšãƒªã‚¨ãƒ³ã‚¹å‘ä¸Š**: å®Ÿéš›ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã«ç›´çµã™ã‚‹æ€§èƒ½æŒ‡æ¨™ã®æ¸¬å®š
- **ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£ç¢ºä¿**: Vercelç’°å¢ƒã§ã®è² è·å¢—åŠ æ™‚ã®æ€§èƒ½ç‰¹æ€§æŠŠæ¡
- **ç¶™ç¶šçš„ç›£è¦–**: CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§ã®è‡ªå‹•æ€§èƒ½ç›£è¦–
- **æœ€é©åŒ–æŒ‡é‡**: å…·ä½“çš„ãªæ”¹å–„ææ¡ˆã«ã‚ˆã‚‹ç¶™ç¶šçš„ãªæ€§èƒ½å‘ä¸Š

### 7.2 Next.js ç‰¹æœ‰ã®æœ€é©åŒ–ãƒã‚¤ãƒ³ãƒˆ

- **Image Optimization**: next/image ã«ã‚ˆã‚‹ç”»åƒæœ€é©åŒ–
- **Code Splitting**: å‹•çš„ã‚¤ãƒ³ãƒãƒ¼ãƒˆã«ã‚ˆã‚‹ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºæœ€é©åŒ–
- **ISR**: Incremental Static Regeneration ã«ã‚ˆã‚‹æ€§èƒ½å‘ä¸Š
- **API Routes**: ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰å‡¦ç†ã®æœ€é©åŒ–
- **Prisma**: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¯ã‚¨ãƒªã®æœ€é©åŒ–

### 7.3 ç¶™ç¶šçš„æ”¹å–„

- **å®šæœŸçš„ãªæ€§èƒ½æ¸¬å®š**: é€±æ¬¡ãƒ»æœˆæ¬¡ã§ã®æ€§èƒ½ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æ
- **é–¾å€¤ç®¡ç†**: æ€§èƒ½åŠ£åŒ–ã®æ—©æœŸæ¤œå‡º
- **æœ€é©åŒ–å®Ÿè£…**: æ¸¬å®šçµæœã«åŸºã¥ãå…·ä½“çš„ãªæ”¹å–„å®Ÿè£…
- **ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯æ›´æ–°**: æ–°æ©Ÿèƒ½è¿½åŠ ã«åˆã‚ã›ãŸæ€§èƒ½åŸºæº–è¦‹ç›´ã—

ã“ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆå®Ÿè£…ã‚¬ã‚¤ãƒ‰ã«ã‚ˆã‚Šã€Next.js + PostgreSQL + Vercel æ§‹æˆã§ã®é«˜æ€§èƒ½ãªã‚·ã‚¹ãƒ†ãƒ é‹ç”¨ã‚’å®Ÿç¾ã—ã¾ã™ã€‚
