# 技術アーキテクチャ詳細

## システムアーキテクチャ概要

```
┌─────────────────────────────────────────────────────────┐
│                     クライアント層                       │
│  ┌──────────────────────────────────────────────────┐  │
│  │   Next.js 14 (App Router) + TypeScript            │  │
│  │   Radix UI / TailwindCSS / React Hook Form       │  │
│  └──────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────┐
│                      API層                              │
│  ┌──────────────────────────────────────────────────┐  │
│  │   Next.js API Routes (App Router)                │  │
│  │   NextAuth.js (認証) / Middleware                 │  │
│  └──────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────┐
│                    データアクセス層                      │
│  ┌──────────────────────────────────────────────────┐  │
│  │   Prisma ORM 5.14.0                              │  │
│  │   トランザクション管理 / クエリ最適化              │  │
│  └──────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────┐
│                   データストレージ層                     │
│  ┌────────────────────┐  ┌────────────────────────┐  │
│  │   PostgreSQL       │  │   Redis (Cache)        │  │
│  │   (Primary DB)     │  │   セッション/キャッシュ │  │
│  └────────────────────┘  └────────────────────────┘  │
└─────────────────────────────────────────────────────────┘
```

## 技術スタック詳細

### フロントエンド技術

#### コアフレームワーク
| 技術 | バージョン | 用途 |
|-----|-----------|------|
| Next.js | 14.2.29 | フルスタックフレームワーク |
| React | 18.3.1 | UIライブラリ |
| TypeScript | 5.8.3 | 型安全性 |

#### UIコンポーネント
| ライブラリ | 用途 | 特徴 |
|-----------|------|------|
| Radix UI | 基本UIコンポーネント | アクセシビリティ対応 |
| Lucide React | アイコン | 軽量・カスタマイズ可能 |
| TailwindCSS | スタイリング | ユーティリティファースト |
| class-variance-authority | スタイル管理 | バリアント管理 |

#### フォーム・状態管理
| ライブラリ | 用途 |
|-----------|------|
| React Hook Form | フォーム管理 |
| Zod | バリデーション |
| date-fns | 日付処理 |

#### データ可視化
| ライブラリ | 用途 |
|-----------|------|
| Recharts | グラフ・チャート |
| XLSX / ExcelJS | Excel処理 |

### バックエンド技術

#### サーバーサイド
| 技術 | 用途 | 実装状況 |
|-----|------|---------|
| Next.js API Routes | REST API | ✅ 実装済み |
| NextAuth.js | 認証・認可 | ✅ 実装済み |
| Prisma ORM | データベース接続 | ✅ 実装済み |
| bcryptjs | パスワード暗号化 | ✅ 実装済み |
| jsonwebtoken | JWT管理 | ✅ 実装済み |

#### データストレージ
| 技術 | 用途 | 設定 |
|-----|------|------|
| PostgreSQL | メインDB | Neon/Supabase対応 |
| Redis | キャッシュ・セッション | 実装準備済み |

#### 外部連携
| ライブラリ | 用途 |
|-----------|------|
| Nodemailer | メール送信 |
| Axios | HTTP クライアント |
| Puppeteer | PDF生成（予定） |

### 開発環境・ツール

#### ビルド・開発ツール
| ツール | 用途 |
|--------|------|
| Docker | コンテナ化 |
| Docker Compose | 環境構築 |
| ESLint | コード品質 |
| Prettier | コードフォーマット |

#### テスト
| ツール | 用途 | カバレッジ |
|--------|------|-----------|
| Jest | ユニットテスト | 準備中 |
| Playwright | E2Eテスト | 準備中 |
| Testing Library | コンポーネントテスト | 準備中 |

## ディレクトリ構造詳細

```
src/
├── app/                    # Next.js App Router
│   ├── api/               # APIルート（54エンドポイント）
│   │   ├── auth/         # 認証
│   │   ├── career/       # キャリア管理
│   │   ├── career-goals/ # キャリア目標
│   │   ├── profiles/     # プロフィール
│   │   ├── skills/       # スキル管理
│   │   ├── work/         # 作業実績
│   │   ├── trainings/    # 研修管理
│   │   └── reports/      # レポート
│   └── [pages]/          # 画面コンポーネント（14画面）
├── components/            # 再利用可能コンポーネント
│   ├── ui/               # UIコンポーネント
│   ├── forms/            # フォームコンポーネント
│   └── layouts/          # レイアウト
├── database/
│   └── prisma/
│       ├── schema.prisma # DB スキーマ（45テーブル）
│       └── migrations/   # マイグレーション
├── lib/                  # ユーティリティ
│   ├── auth/            # 認証関連
│   ├── db/              # DB接続
│   └── utils/           # 汎用関数
├── hooks/               # カスタムフック
├── types/               # TypeScript型定義
└── styles/              # グローバルスタイル
```

## データベース設計

### テーブル分類
```
マスタテーブル (MST_) - 15テーブル
├── MST_Tenant         # テナント
├── MST_TenantSettings # テナント設定
├── MST_Skill*         # スキル関連
└── MST_*              # その他マスタ

トランザクションテーブル (TRN_) - 12テーブル
├── TRN_CareerPlan     # キャリアプラン
├── TRN_GoalProgress   # 目標進捗
├── TRN_ProjectRecord  # プロジェクト実績
└── TRN_*              # その他トランザクション

システムテーブル - 18テーブル
├── UserAuth           # 認証
├── SystemConfig       # システム設定
├── AuditLog          # 監査ログ
└── *                  # その他システム
```

### 主要リレーション
- Employee ↔ Department (多対多)
- Employee ↔ Skill (多対多 + グレード)
- Employee → CareerPlan (1対多)
- JobType ↔ Skill (多対多 + 要求レベル)

## セキュリティアーキテクチャ

### 認証・認可
```
1. NextAuth.js によるセッション管理
2. JWT トークンによるAPI認証
3. ロールベースアクセス制御（RBAC）
4. テナント分離
```

### データ保護
```
1. bcryptjs によるパスワードハッシュ
2. Prisma による SQLインジェクション対策
3. XSS 対策（React のデフォルト）
4. HTTPS 通信（本番環境）
```

## パフォーマンス最適化

### フロントエンド
- Next.js の自動コード分割
- 画像最適化（Next/Image）
- 静的生成（SSG）とISRの活用
- React.memo によるレンダリング最適化

### バックエンド
- Prisma のクエリ最適化
- Redis キャッシュ（準備済み）
- データベースインデックス
- ページネーション実装

## デプロイメント構成

### 開発環境
```yaml
Docker Compose 構成:
- app: Next.js アプリケーション
- postgres: PostgreSQL データベース
- redis: Redis キャッシュ（オプション）
```

### 本番環境（推奨）
```
- Vercel / AWS Amplify (Next.js)
- Neon / Supabase (PostgreSQL)
- Upstash Redis (キャッシュ)
- CloudFlare (CDN)
```

## モニタリング・運用

### ログ管理
- システムログ（SystemLog テーブル）
- 監査ログ（AuditLog テーブル）
- エラートラッキング（準備中）

### パフォーマンス監視
- バッチジョブログ（BatchJobLog）
- APIレスポンスタイム
- データベースクエリ性能

## 今後の技術的改善

### 短期目標
1. テストカバレッジの向上
2. API ドキュメント自動生成
3. CI/CD パイプライン強化

### 中期目標
1. マイクロフロントエンド検討
2. GraphQL 導入評価
3. リアルタイム機能（WebSocket）

### 長期目標
1. マイクロサービス化
2. Kubernetes 導入
3. 機械学習統合（スキル推奨等）

---
*最終更新: 2025年1月28日*