# 画面定義書: SCR_AUT_Login

## 基本情報

| 項目 | 値 |
|------|-----|
| 画面ID | SCR_AUT_Login |
| 画面名称 | ログイン画面 |
| 機能カテゴリ | 認証 |
| 主な対応機能 | ユーザー認証・ログイン |
| 主な利用者 | 全ユーザー |
| 優先度 | 高 |
| 生成日時 | 2025-06-03 00:59:37 |

## 画面概要

### 目的
システム利用者が安全かつ簡便にログイン認証を行う画面。ID/パスワード認証およびSSO（シングルサインオン）に対応。セキュアな認証基盤を提供し、業務システムの起点となる。

### 主な機能
- ID/パスワード認証（ユーザーID（社員番号またはメール）とパスワードによる認証、パスワード表示/非表示の切り替え機能、入力値のバリデーション）
- SSO認証（シングルサインオンによる認証、SAML/OIDC対応、IdP（Identity Provider）との連携）
- セキュリティ機能（アカウントロック機能、ログイン失敗回数の制限、認証履歴の記録）
- パスワードリセット（パスワード忘れ時のリセット機能、セキュアなリセットプロセス）

## 画面レイアウト

中央配置のログインフォーム。会社ロゴとシステム名をヘッダーに配置し、ユーザーID・パスワード入力欄、各種ボタン、エラーメッセージ表示エリアを縦に配置。フッターにコピーライトを表示。

| セクション名 | 説明 |
|-------------|------|
| ヘッダー部 | 会社ロゴと「年間スキル報告書システム ログイン」タイトル |
| 認証フォーム部 | ユーザーID・パスワード入力欄、パスワード表示チェックボックス |
| アクション部 | ログインボタン、SSOログインボタン、パスワードリセットリンク |
| メッセージ部 | エラー時メッセージ表示エリア |
| フッター部 | コピーライト表示 |

## 画面項目定義

| 項目ID | 項目名 | APIパラメータ対応 | データ型 | I/O区分 | 必須 | 備考 |
|--------|--------|-------------------|----------|---------|------|------|
| user_id | ユーザーID | user_id | text | input | ○ | 社員番号またはメール。英数字・記号対応 |
| password | パスワード | password | password | input | ○ | 8文字以上、英数字・記号組み合わせ |
| show_password | パスワードを表示 |  | checkbox | input | × | 入力時マスク/表示切替 |
| login_button | ログインボタン |  | button | action | × | 必須項目入力後のみ活性 |
| sso_login_button | SSOでログイン |  | button | action | × | SSO連携設定時のみ表示 |
| password_reset_link | パスワードを忘れた方はこちら |  | link | action | × | パスワードリセット画面へ遷移 |
| error_message | エラーメッセージ |  | label | output | × | 入力エラー・認証失敗時に表示 |

## 操作フロー

| ステップ | 操作 | 説明 |
|----------|------|------|
| 1 | ログイン画面表示 | ログイン画面が表示される。SSO設定に応じてSSOボタンの表示/非表示を制御 |
| 2 | ユーザーID・パスワード入力 | ユーザーIDとパスワードを入力フィールドに入力 |
| 3 | ログインボタン押下 | ログインボタンを押下して認証実行 |
| 4 | 入力値バリデーション | 必須項目チェック、文字数制限、形式チェックを実行 |
| 5 | API認証呼び出し | ユーザー認証APIを呼び出して認証処理を実行 |
| 6 | 認証結果判定 | 認証成功時はセッション発行、失敗時は失敗回数チェック |
| 7 | 画面遷移 | 認証成功時はテナント選択画面へ遷移、失敗時はエラーメッセージ表示 |

## イベント・アクション定義

| イベントID | トリガー/アクション | イベント内容・アクション詳細 | 紐付くAPI ID・名称 | メッセージ表示 |
|------------|---------------------|------------------------------|-------------------|----------------|
| E01 | ログインボタン押下 | 入力値バリデーション→API-001呼出→認証成功時はSCR_TEN_Selectへ遷移 | API-001:ユーザー認証API | エラー時：エラーメッセージ表示 |
| E02 | SSOでログインボタン押下 | API-002呼出（IdPリダイレクト）→認証成功時はSCR_TEN_Selectへ遷移 | API-002:SSO認証API | エラー時：エラーメッセージ表示 |
| E03 | パスワード表示チェック | パスワード入力欄の表示/非表示切替 |  |  |
| E04 | パスワードを忘れた方はこちら | パスワードリセット画面へ遷移 |  |  |
| E05 | Enterキー押下 | ログインボタン押下と同等処理 | API-001 |  |
| E06 | 入力エラー | 必須項目未入力・形式不正・認証失敗 | API-001/002 | エラーメッセージ表示 |
| E07 | ログイン成功 | セッション発行・ユーザー権限取得・SCR_TEN_Selectへ遷移 | API-001/002 |  |
| E08 | ログイン失敗 | エラーメッセージ表示・パスワード再入力促す | API-001/002 | ユーザーIDまたはパスワードが違います |
| E09 | アカウントロック | ログイン失敗回数上限超過 | API-001/002 | アカウントがロックされました |

## バリデーション

### 入力値検証

| 対象フィールド | ルール | エラーメッセージ |
|----------------|--------|------------------|
| user_id | required, max_length:50, alphanumeric_symbols | ユーザーIDは必須です。50文字以内の英数字・記号で入力してください。 |
| password | required, min_length:8, alphanumeric_symbols_combination | パスワードは必須です。8文字以上の英数字・記号の組み合わせで入力してください。 |

### ビジネスルール検証

| ルール | 説明 |
|--------|------|
| ログイン失敗回数上限チェック | ログイン失敗回数が5回を超えた場合、アカウントをロック |
| アカウントロック状態確認 | ログイン時にアカウントロック状態をチェック |
| パスワード有効期限確認 | パスワードの有効期限をチェック |
| SQLインジェクション対策 | 特殊文字の入力値検証を実施 |

## エラーハンドリング

### エラーメッセージ一覧

| エラーコード | エラー種別 | メッセージ | 対応アクション |
|-------------|------------|------------|----------------|
| MSG01 | authentication_error | ユーザーIDまたはパスワードが違います | show_error_message |
| MSG02 | validation_error | 必須項目が入力されていません | show_field_error |
| MSG03 | account_lock_error | アカウントがロックされました。管理者に連絡してください | show_error_message |
| MSG04 | system_error | システム障害が発生しました。再度お試しください | show_error_page |

## セキュリティ要件

### 認証・認可

| 項目 | 設定 |
|------|------|
| 認証方式 | form_based_and_sso |
| セッション管理 | 有効 |
| パスワード暗号化 | 有効 |

### データ保護

| 項目 | 設定 |
|------|------|
| CSRF保護 | 有効 |
| 入力サニタイゼーション | 有効 |
| SQLインジェクション対策 | 有効 |
| XSS対策 | 有効 |

## パフォーマンス要件

| 項目 | 値 |
|------|----|
| 読み込み時間目標 | 1s |
| ログイン処理時間目標 | 2s |
| SSO処理時間目標 | 3s |
| 最適化手法 | image_compression, css_minification, js_minification |
| キャッシュ | browser_cache |

## アクセシビリティ

| 項目 | 対応 |
|------|------|
| キーボードナビゲーション | 対応 |
| スクリーンリーダー | 対応 |
| カラーコントラスト | AA |
| フォントサイズ調整 | 対応 |
| ARIAラベル | 対応 |

## レスポンシブデザイン

| 項目 | 対応 |
|------|------|
| モバイル | 対応 |
| タブレット | 対応 |
| デスクトップ | 対応 |
| ブレークポイント | 767px, 768px, 1024px, 1200px |
| レイアウト適応 | {'desktop': 'centered_800px', 'tablet': 'centered_responsive', 'mobile': 'full_width_touch_friendly'} |

## 関連API

| API ID | API名称 | メソッド | エンドポイント | 説明 |
|--------|---------|----------|---------------|------|
| API-001 | ユーザー認証API | POST | /api/auth/login | ユーザー認証を行うAPI |
| API-002 | SSO認証API | GET | /api/auth/sso | SSO認証を行うAPI |
| API-003 | ログアウトAPI | POST | /api/auth/logout | ログアウト処理を行うAPI |
| API-004 | パスワードリセットAPI | POST | /api/auth/password-reset | パスワードリセット処理を行うAPI |

## 関連画面

| 画面ID | 画面名称 | 関係種別 | 条件 |
|--------|----------|----------|------|
| SCR_TEN_Select | テナント選択画面 | transition_to | 認証成功時 |
| SCR_CMN_Home | ホームダッシュボード画面 | transition_to | テナント選択後 |
| SCR_AUT_PasswordReset | パスワードリセット画面 | link_to | パスワードを忘れた場合 |

## ビジネスルール

- マルチテナント環境の認証起点となる重要な画面
- セキュリティを最優先とした設計
- ユーザビリティとセキュリティのバランスを重視
- ログイン試行回数は5回まで
- アカウントロック時は管理者による解除が必要
- 全認証トランザクションを記録
- ログイン成功/失敗の履歴管理
- セキュリティ監査への対応

## 特別要件

### SSO設定

- SSO未設定時は「SSOでログイン」ボタンを非表示
- SAML/OIDC/代理認証等の方式に対応
- IdP設定はシステム管理者が行う

### 多要素認証（MFA）

- 将来的な拡張として設計上考慮
- SMS認証、アプリ認証等の追加予定

### 監査証跡

- 全認証トランザクションを記録
- ログイン成功/失敗の履歴管理
- セキュリティ監査への対応

## 特記事項

- 実装時の注意事項：セッション管理の実装が必要
- 実装時の注意事項：ブルートフォース攻撃対策が必要
- 実装時の注意事項：CSRF対策の実装が必要
- 実装時の注意事項：TLS通信の必須化
- 実装時の注意事項：パスワードのハッシュ化保存

## 備考

- 将来的な認証方式拡張に対応可能な設計
- 多要素認証の将来対応予定
- マルチテナント環境対応
- セキュリティ監査要件への対応

## 改版履歴

| バージョン | 更新日 | 更新者 | 変更内容 |
|------------|--------|--------|----------|
| 1.0 | 2025-05-28 | システム | 初版作成 |
| 1.1 | 2025-06-01 | システム | 詳細仕様追加・セキュリティ要件強化 |
| 2.0 | 2025-06-03 | システム | 画面定義書の詳細内容を反映した完全版YAML作成 |

