# 必須セクション詳細ガイドライン

このドキュメントでは、テーブル詳細YAML定義ファイルにおける4つの必須セクション（`revision_history`、`overview`、`notes`、`business_rules`）の詳細なガイドラインを提供します。これらのセクションは品質管理・監査・運用保守の観点から**いかなる場合も省略禁止**です。

## 1. revision_history（改版履歴）- 【絶対省略禁止】

### 目的
- 変更管理・監査の基盤となる重要情報
- テーブル定義の変更履歴を時系列で記録
- 変更の理由・影響範囲を明確化
- 監査要件への対応

### 必須要素
- **バージョン番号**: セマンティックバージョニング（Major.Minor.Patch）
- **日付**: YYYY-MM-DD形式
- **変更者**: 担当者名または担当チーム名
- **変更内容**: 具体的な変更内容の説明

### 記述スタイル
- 最新の変更を先頭に追加（降順）
- 変更内容は具体的かつ簡潔に
- 影響範囲や変更理由も記載

### 最低要件
- **最低1エントリ必須**

### 例
```yaml
revision_history:
  - version: "1.2.0"
    date: "2025-06-12"
    author: "開発チーム"
    changes: "カラム追加 - manager_id, job_type_idを追加（組織階層管理機能対応）"
  - version: "1.1.0"
    date: "2025-05-20"
    author: "開発チーム"
    changes: "インデックス追加 - 検索性能改善のためemployee_statusにインデックス追加"
  - version: "1.0.0"
    date: "2025-05-01"
    author: "開発チーム"
    changes: "初版作成 - MST_Employeeテーブルの詳細定義"
```

## 2. overview（概要・目的）- 【絶対省略禁止】

### 目的
- テーブルの存在理由と使用方法を明確にする基本情報
- 設計意図の明確化
- 他テーブルとの関係性の説明
- 業務コンテキストの共有

### 必須要素
- **テーブルの目的**: このテーブルが存在する理由
- **主な機能**: テーブルが提供する主要な機能
- **関連する業務プロセス**: このテーブルが関わる業務フロー
- **他テーブルとの関係**: 主要な関連テーブルとの関係性

### 記述スタイル
- 箇条書きと説明文の組み合わせ
- 業務用語と技術用語のバランス
- 第三者が理解できる明確な説明

### 最低要件
- **最低50文字以上必須**

### 例
```yaml
overview: |
  組織に所属する全社員の基本的な個人情報と組織情報を一元管理するマスタテーブル。
  
  主な目的：
  - 社員の基本情報（氏名、連絡先、入社日等）の管理
  - 組織構造（部署、役職、上司関係）の管理
  - 認証・権限管理のためのユーザー情報提供
  - 人事システムとの連携データ基盤
  
  このテーブルは年間スキル報告書システムの中核となるマスタデータであり、
  スキル管理、目標管理、作業実績管理の全ての機能で参照される。
```

## 3. notes（特記事項）- 【絶対省略禁止】

### 目的
- 運用・保守・セキュリティに関わる重要な補足情報
- 特殊な制約条件や考慮点の明文化
- 将来の拡張・変更時の注意点
- 監査・セキュリティ要件の記録

### 必須要素
- **運用上の注意点**: 運用時に考慮すべき事項
- **セキュリティ要件**: 暗号化、アクセス制御等
- **特殊な制約**: 通常と異なる制約条件
- **関連システム連携**: 外部システムとの連携ポイント

### 記述スタイル
- 箇条書きで簡潔に記述
- 重要度の高い項目から順に記載
- 具体的な例や条件を含める

### 最低要件
- **最低3項目以上必須**

### 例
```yaml
notes:
  - "個人情報（氏名、氏名カナ、電話番号、生年月日）は暗号化対象"
  - "論理削除は is_deleted フラグで管理"
  - "manager_idによる自己参照で組織階層を表現"
  - "人事システムとの連携でマスタデータを同期"
  - "認証・権限管理システムの基盤テーブル"
  - "スキル管理・目標管理・作業実績管理の全機能で参照される"
```

## 4. business_rules（業務ルール）- 【絶対省略禁止】

### 目的
- データの整合性と業務要件を保証するための制約条件
- 業務固有のルールの明文化
- 実装時の制約条件の明確化
- 要件トレーサビリティの確保

### 必須要素
- **一意性制約**: 一意であるべき項目とその理由
- **参照整合性**: 外部キー制約の詳細
- **業務固有ルール**: 特定の業務ドメインに関するルール
- **データ検証ルール**: 入力値の検証条件

### 記述スタイル
- 箇条書きで明確に記述
- 「〜すべき」「〜である」等の断定的な表現
- 具体的な条件や例外を含める

### 最低要件
- **最低3項目以上必須**

### 例
```yaml
business_rules:
  - "社員番号（employee_code）は一意で変更不可"
  - "メールアドレス（email）は認証用のため一意制約必須"
  - "在籍状況（employee_status）がRETIREDの場合、論理削除フラグをtrueに設定"
  - "直属の上司（manager_id）は同一部署内の上位役職者のみ設定可能"
  - "雇用形態（employment_status）に応じた権限・機能制限を適用"
  - "個人情報の暗号化は法的要件に基づく必須対応"
  - "監査証跡として作成日時・更新日時は自動設定"
```

## 必須セクション検証ツール

テーブル詳細YAML定義ファイルの必須セクションを検証するには、以下のコマンドを使用します：

```bash
# 特定テーブルの検証
python docs/design/database/tools/database_consistency_checker/run_check.py --checks yaml_format --tables MST_Employee

# 全テーブルの検証
python docs/design/database/tools/database_consistency_checker/run_check.py --checks yaml_format

# 詳細出力モード
python docs/design/database/tools/database_consistency_checker/run_check.py --checks yaml_format --tables MST_Employee --verbose
```

## Git pre-commitフックのインストール

コミット前に自動的に必須セクションの検証を実行するGit pre-commitフックをインストールするには、以下のコマンドを実行します：

```bash
# Git pre-commitフックのインストール
cd docs/design/database/tools/database_consistency_checker
./install_git_hook.sh
```

## よくある問題と解決方法

### 1. revision_historyが不足している
- **問題**: `revision_history`セクションが存在しない、または最低1エントリがない
- **解決方法**: 初版の場合は、初版作成のエントリを追加。既存テーブルの場合は、変更履歴を追加。

### 2. overviewが不足している
- **問題**: `overview`セクションが存在しない、または50文字未満
- **解決方法**: テーブルの目的、主な機能、関連する業務プロセス、他テーブルとの関係を含む説明を追加。

### 3. notesが不足している
- **問題**: `notes`セクションが存在しない、または3項目未満
- **解決方法**: 運用上の注意点、セキュリティ要件、特殊な制約、関連システム連携等を追加。

### 4. business_rulesが不足している
- **問題**: `business_rules`セクションが存在しない、または3項目未満
- **解決方法**: 一意性制約、参照整合性、業務固有ルール、データ検証ルール等を追加。

## 必須セクションの重要性

これらの4つの必須セクションは、以下の理由から絶対に省略してはいけません：

1. **品質管理**: 設計意図の明確化、変更履歴の追跡、業務ルールの明文化により、高品質なデータベース設計を実現
2. **監査要件**: 変更履歴、特記事項、業務ルールの記録により、監査時の説明責任を果たす
3. **運用保守**: 特殊な制約条件や考慮点を明文化することで、運用・保守時のトラブルを防止
4. **知識継承**: 設計意図や業務ルールを明文化することで、チーム間・世代間の知識継承を促進

これらのセクションを適切に記載することで、データベース設計の品質向上、運用効率化、リスク低減に貢献します。
