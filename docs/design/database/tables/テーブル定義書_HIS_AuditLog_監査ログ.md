# ãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©æ›¸: HIS_AuditLog (ç›£æŸ»ãƒ­ã‚°)

## ğŸ“‹ åŸºæœ¬æƒ…å ±

| é …ç›® | å†…å®¹ |
|------|------|
| ãƒ†ãƒ¼ãƒ–ãƒ«å | HIS_AuditLog |
| è«–ç†å | ç›£æŸ»ãƒ­ã‚° |
| ã‚«ãƒ†ã‚´ãƒª | å±¥æ­´ç³» |
| ä½œæˆæ—¥ | 2025-06-01 |

> **æ³¨æ„**: æœ¬ãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©æ›¸ã¯è‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã™ã€‚æ‰‹å‹•ç·¨é›†ã¯è¡Œã‚ãªã„ã§ãã ã•ã„ã€‚
> è©³ç´°å®šç¾©ã®å¤‰æ›´ã¯ `table-details/HIS_AuditLog_details.yaml` ã§è¡Œã£ã¦ãã ã•ã„ã€‚


## ğŸ“ æ”¹ç‰ˆå±¥æ­´

> **æ³¨æ„**: æ”¹ç‰ˆå±¥æ­´ã®è©³ç´°ã¯ä»¥ä¸‹ã®YAMLãƒ•ã‚¡ã‚¤ãƒ«ã§ç®¡ç†ã•ã‚Œã¦ã„ã¾ã™ï¼š
> `table-details/TABLE_NAME_details.yaml`

| ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | æ›´æ–°æ—¥ | æ›´æ–°è€… | ä¸»ãªå¤‰æ›´å†…å®¹ |
|------------|--------|--------|-------------|
| 1.0.0 | 2025-06-01 | é–‹ç™ºãƒãƒ¼ãƒ  | åˆç‰ˆä½œæˆ - HIS_AuditLogã®è©³ç´°å®šç¾© |


## ğŸ“ ãƒ†ãƒ¼ãƒ–ãƒ«æ¦‚è¦

ã‚·ã‚¹ãƒ†ãƒ å†…ã§ç™ºç”Ÿã™ã‚‹å…¨ã¦ã®é‡è¦ãªæ“ä½œã‚’è¨˜éŒ²ã™ã‚‹ç›£æŸ»ãƒ­ã‚°ãƒ†ãƒ¼ãƒ–ãƒ«ã§ã™ã€‚

ä¸»ãªç›®çš„ï¼š
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£æŸ»ã®ãŸã‚ã®æ“ä½œå±¥æ­´è¨˜éŒ²
- ã‚·ã‚¹ãƒ†ãƒ ä¸æ­£åˆ©ç”¨ã®æ¤œçŸ¥ãƒ»è¿½è·¡
- ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹è¦ä»¶ã¸ã®å¯¾å¿œ
- ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°æ™‚ã®æ“ä½œå±¥æ­´ç¢ºèª

ã“ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã¯æ³•çš„è¦ä»¶ã‚„ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒªã‚·ãƒ¼ã«åŸºã¥ãã€
90æ—¥é–“ã®ãƒ­ã‚°ä¿æŒæœŸé–“ã‚’è¨­ã‘ã¦ã„ã¾ã™ã€‚


## ğŸ—‚ï¸ ã‚«ãƒ©ãƒ å®šç¾©

| ã‚«ãƒ©ãƒ å | è«–ç†å | ãƒ‡ãƒ¼ã‚¿å‹ | æ¡æ•° | NULL | PK | FK | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ | èª¬æ˜ |
|----------|--------|----------|------|------|----|----|------------|------|
| id | ID | VARCHAR | 50 | Ã— | â— |  |  | ãƒ—ãƒ©ã‚¤ãƒãƒªã‚­ãƒ¼ï¼ˆUUIDï¼‰ |
| is_deleted | å‰Šé™¤ãƒ•ãƒ©ã‚° | BOOLEAN |  | Ã— |  |  |  | è«–ç†å‰Šé™¤ãƒ•ãƒ©ã‚° |
| tenant_id | ãƒ†ãƒŠãƒ³ãƒˆID | VARCHAR | 50 | Ã— |  | â— |  | ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆè­˜åˆ¥å­ |
| id | ID | VARCHAR | 50 | â—‹ |  |  |  | ãƒ—ãƒ©ã‚¤ãƒãƒªã‚­ãƒ¼ï¼ˆUUIDï¼‰ |
| user_id | ãƒ¦ãƒ¼ã‚¶ãƒ¼ID | VARCHAR | 50 | â—‹ |  | â— |  | æ“ä½œã‚’å®Ÿè¡Œã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ID |
| session_id | ã‚»ãƒƒã‚·ãƒ§ãƒ³ID | VARCHAR | 100 | â—‹ |  |  |  | æ“ä½œæ™‚ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³è­˜åˆ¥å­ |
| action_type | ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ç¨®åˆ¥ | ENUM |  | â—‹ |  |  |  | å®Ÿè¡Œã•ã‚ŒãŸã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®ç¨®åˆ¥ï¼ˆCREATE:ä½œæˆã€READ:å‚ç…§ã€UPDATE:æ›´æ–°ã€DELETE:å‰Šé™¤ã€LOGIN:ãƒ­ã‚°ã‚¤ãƒ³ã€LOGOUT:ãƒ­ã‚°ã‚¢ã‚¦ãƒˆï¼‰ |
| target_table | å¯¾è±¡ãƒ†ãƒ¼ãƒ–ãƒ« | VARCHAR | 100 | â—‹ |  |  |  | æ“ä½œå¯¾è±¡ã®ãƒ†ãƒ¼ãƒ–ãƒ«å |
| target_id | å¯¾è±¡ãƒ¬ã‚³ãƒ¼ãƒ‰ID | VARCHAR | 50 | â—‹ |  |  |  | æ“ä½œå¯¾è±¡ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ID |
| old_values | å¤‰æ›´å‰å€¤ | TEXT |  | â—‹ |  |  |  | æ›´æ–°ãƒ»å‰Šé™¤å‰ã®ãƒ‡ãƒ¼ã‚¿ï¼ˆJSONå½¢å¼ï¼‰ |
| new_values | å¤‰æ›´å¾Œå€¤ | TEXT |  | â—‹ |  |  |  | ä½œæˆãƒ»æ›´æ–°å¾Œã®ãƒ‡ãƒ¼ã‚¿ï¼ˆJSONå½¢å¼ï¼‰ |
| ip_address | IPã‚¢ãƒ‰ãƒ¬ã‚¹ | VARCHAR | 45 | â—‹ |  |  |  | æ“ä½œå…ƒã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ˆIPv6å¯¾å¿œï¼‰ |
| user_agent | ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ | VARCHAR | 500 | â—‹ |  |  |  | æ“ä½œæ™‚ã®ãƒ–ãƒ©ã‚¦ã‚¶ãƒ»ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³æƒ…å ± |
| result_status | å®Ÿè¡Œçµæœ | ENUM |  | â—‹ |  |  | SUCCESS | æ“ä½œã®å®Ÿè¡Œçµæœï¼ˆSUCCESS:æˆåŠŸã€FAILURE:å¤±æ•—ã€ERROR:ã‚¨ãƒ©ãƒ¼ï¼‰ |
| error_message | ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ | TEXT |  | â—‹ |  |  |  | æ“ä½œå¤±æ•—æ™‚ã®ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ |
| execution_time_ms | å®Ÿè¡Œæ™‚é–“ | INTEGER |  | â—‹ |  |  |  | æ“ä½œã®å®Ÿè¡Œæ™‚é–“ï¼ˆãƒŸãƒªç§’ï¼‰ |
| is_deleted | å‰Šé™¤ãƒ•ãƒ©ã‚° | BOOLEAN |  | â—‹ |  |  |  | è«–ç†å‰Šé™¤ãƒ•ãƒ©ã‚°ï¼ˆç›£æŸ»ãƒ­ã‚°ã¯ç‰©ç†å‰Šé™¤ç¦æ­¢ï¼‰ |
| tenant_id | ãƒ†ãƒŠãƒ³ãƒˆID | VARCHAR | 50 | â—‹ |  | â— |  | ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆè­˜åˆ¥å­ |
| created_at | ä½œæˆæ—¥æ™‚ | TIMESTAMP |  | â—‹ |  |  | CURRENT_TIMESTAMP | ãƒ¬ã‚³ãƒ¼ãƒ‰ä½œæˆæ—¥æ™‚ |
| updated_at | æ›´æ–°æ—¥æ™‚ | TIMESTAMP |  | â—‹ |  |  | CURRENT_TIMESTAMP | ãƒ¬ã‚³ãƒ¼ãƒ‰æ›´æ–°æ—¥æ™‚ |
| created_by | ä½œæˆè€… | VARCHAR | 50 | â—‹ |  |  |  | ãƒ¬ã‚³ãƒ¼ãƒ‰ä½œæˆè€…ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ID |
| updated_by | æ›´æ–°è€… | VARCHAR | 50 | â—‹ |  |  |  | ãƒ¬ã‚³ãƒ¼ãƒ‰æ›´æ–°è€…ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ID |
| created_at | ä½œæˆæ—¥æ™‚ | TIMESTAMP |  | Ã— |  |  | CURRENT_TIMESTAMP | ãƒ¬ã‚³ãƒ¼ãƒ‰ä½œæˆæ—¥æ™‚ |
| updated_at | æ›´æ–°æ—¥æ™‚ | TIMESTAMP |  | Ã— |  |  | CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | ãƒ¬ã‚³ãƒ¼ãƒ‰æ›´æ–°æ—¥æ™‚ |
| created_by | ä½œæˆè€… | VARCHAR | 50 | Ã— |  |  |  | ãƒ¬ã‚³ãƒ¼ãƒ‰ä½œæˆè€…ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ID |
| updated_by | æ›´æ–°è€… | VARCHAR | 50 | Ã— |  |  |  | ãƒ¬ã‚³ãƒ¼ãƒ‰æ›´æ–°è€…ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ID |

## ğŸ” ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹å®šç¾©

| ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹å | ã‚«ãƒ©ãƒ  | ãƒ¦ãƒ‹ãƒ¼ã‚¯ | èª¬æ˜ |
|----------------|--------|----------|------|
| idx_his_auditlog_id | id | â—‹ | ãƒ—ãƒ©ã‚¤ãƒãƒªã‚­ãƒ¼æ¤œç´¢ç”¨ï¼ˆä¸€æ„ï¼‰ |
| idx_his_auditlog_user_id | user_id | Ã— | ãƒ¦ãƒ¼ã‚¶ãƒ¼IDæ¤œç´¢ç”¨ |
| idx_his_auditlog_tenant_id | tenant_id | Ã— | ãƒ†ãƒŠãƒ³ãƒˆIDæ¤œç´¢ç”¨ |
| idx_his_auditlog_action_type | action_type | Ã— | ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ç¨®åˆ¥æ¤œç´¢ç”¨ |
| idx_his_auditlog_target_table | target_table | Ã— | å¯¾è±¡ãƒ†ãƒ¼ãƒ–ãƒ«æ¤œç´¢ç”¨ |
| idx_his_auditlog_created_at | created_at | Ã— | ä½œæˆæ—¥æ™‚æ¤œç´¢ç”¨ï¼ˆæ™‚ç³»åˆ—æ¤œç´¢ï¼‰ |
| idx_his_auditlog_user_created | user_id, created_at | Ã— | ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ¥æ™‚ç³»åˆ—æ¤œç´¢ç”¨ |
| idx_his_auditlog_tenant_created | tenant_id, created_at | Ã— | ãƒ†ãƒŠãƒ³ãƒˆåˆ¥æ™‚ç³»åˆ—æ¤œç´¢ç”¨ |

## ğŸ”’ åˆ¶ç´„å®šç¾©

| åˆ¶ç´„å | åˆ¶ç´„ã‚¿ã‚¤ãƒ— | å¯¾è±¡ã‚«ãƒ©ãƒ  | æ¡ä»¶ | èª¬æ˜ |
|--------|------------|------------|------|------|
| chk_his_auditlog_action_type | CHECK |  | action_type IN ('CREATE', 'READ', 'UPDATE', 'DELETE', 'LOGIN', 'LOGOUT') | ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ç¨®åˆ¥å€¤ãƒã‚§ãƒƒã‚¯åˆ¶ç´„ |
| chk_his_auditlog_result_status | CHECK |  | result_status IN ('SUCCESS', 'FAILURE', 'ERROR') | å®Ÿè¡Œçµæœå€¤ãƒã‚§ãƒƒã‚¯åˆ¶ç´„ |
| chk_his_auditlog_execution_time_positive | CHECK |  | execution_time_ms IS NULL OR execution_time_ms >= 0 | å®Ÿè¡Œæ™‚é–“éè² æ•°ãƒã‚§ãƒƒã‚¯åˆ¶ç´„ |

## ğŸ”— å¤–éƒ¨ã‚­ãƒ¼é–¢ä¿‚

| å¤–éƒ¨ã‚­ãƒ¼å | ã‚«ãƒ©ãƒ  | å‚ç…§ãƒ†ãƒ¼ãƒ–ãƒ« | å‚ç…§ã‚«ãƒ©ãƒ  | æ›´æ–°æ™‚ | å‰Šé™¤æ™‚ | èª¬æ˜ |
|------------|--------|--------------|------------|--------|--------|------|
| fk_his_auditlog_tenant | tenant_id | MST_Tenant | id | CASCADE | RESTRICT | ãƒ†ãƒŠãƒ³ãƒˆãƒã‚¹ã‚¿ã¸ã®å¤–éƒ¨ã‚­ãƒ¼ |
| fk_his_auditlog_user | user_id | MST_Employee | id | CASCADE | RESTRICT | ç¤¾å“¡ãƒã‚¹ã‚¿ã¸ã®å¤–éƒ¨ã‚­ãƒ¼ |

## ğŸ“Š ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿

```json
[
  {
    "id": "audit_001",
    "user_id": "emp_001",
    "session_id": "sess_abc123",
    "action_type": "LOGIN",
    "target_table": null,
    "target_id": null,
    "old_values": null,
    "new_values": null,
    "ip_address": "192.168.1.100",
    "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",
    "result_status": "SUCCESS",
    "error_message": null,
    "execution_time_ms": 150,
    "is_deleted": false,
    "tenant_id": "tenant_001",
    "created_by": "system",
    "updated_by": "system"
  },
  {
    "id": "audit_002",
    "user_id": "emp_001",
    "session_id": "sess_abc123",
    "action_type": "UPDATE",
    "target_table": "MST_Employee",
    "target_id": "emp_001",
    "old_values": "{\"name\": \"ç”°ä¸­å¤ªéƒ\", \"email\": \"tanaka@example.com\"}",
    "new_values": "{\"name\": \"ç”°ä¸­å¤ªéƒ\", \"email\": \"tanaka.new@example.com\"}",
    "ip_address": "192.168.1.100",
    "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",
    "result_status": "SUCCESS",
    "error_message": null,
    "execution_time_ms": 250,
    "is_deleted": false,
    "tenant_id": "tenant_001",
    "created_by": "emp_001",
    "updated_by": "emp_001"
  }
]
```

## ğŸ“Œ ç‰¹è¨˜äº‹é …

- ç›£æŸ»ãƒ­ã‚°ã¯æ³•çš„è¦ä»¶ã«ã‚ˆã‚Š90æ—¥é–“ä¿æŒãŒå¿…è¦
- æ©Ÿå¯†æƒ…å ±ï¼ˆold_values, new_valuesï¼‰ã¯æš—å·åŒ–ã—ã¦ä¿å­˜
- ç‰©ç†å‰Šé™¤ã¯ç¦æ­¢ã€è«–ç†å‰Šé™¤ã®ã¿è¨±å¯
- å¤§é‡ãƒ‡ãƒ¼ã‚¿å¯¾å¿œã®ãŸã‚ã€ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ‹ãƒ³ã‚°æ¤œè¨ãŒå¿…è¦
- ãƒ­ã‚°æ¤œç´¢æ€§èƒ½å‘ä¸Šã®ãŸã‚ã€é©åˆ‡ãªã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¨­è¨ˆãŒé‡è¦
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£æŸ»è¦ä»¶ã«åŸºã¥ãè¨­è¨ˆ

## ğŸ“‹ æ¥­å‹™ãƒ«ãƒ¼ãƒ«

- å…¨ã¦ã®é‡è¦ãªæ“ä½œï¼ˆCRUDã€èªè¨¼ï¼‰ã‚’è¨˜éŒ²ã™ã‚‹
- ãƒ­ã‚°ã®æ”¹ã–ã‚“é˜²æ­¢ã®ãŸã‚ã€ä½œæˆå¾Œã®æ›´æ–°ã¯åŸå‰‡ç¦æ­¢
- å€‹äººæƒ…å ±ã‚’å«ã‚€å ´åˆã¯æš—å·åŒ–ã—ã¦ä¿å­˜
- ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†è€…ã®ã¿ãŒãƒ­ã‚°ã‚’å‚ç…§å¯èƒ½
- ãƒ­ã‚°ä¿æŒæœŸé–“ã¯90æ—¥é–“ã€æœŸé–“çµŒéå¾Œã¯è‡ªå‹•å‰Šé™¤
- ç•°å¸¸ãªã‚¢ã‚¯ã‚»ã‚¹ãƒ‘ã‚¿ãƒ¼ãƒ³ã®æ¤œçŸ¥ã«æ´»ç”¨
