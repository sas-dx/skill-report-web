# ãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©æ›¸: MST_UserAuth (ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼æƒ…å ±)

## ğŸ“‹ åŸºæœ¬æƒ…å ±

| é …ç›® | å†…å®¹ |
|------|------|
| ãƒ†ãƒ¼ãƒ–ãƒ«å | MST_UserAuth |
| è«–ç†å | ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼æƒ…å ± |
| ã‚«ãƒ†ã‚´ãƒª | ãƒã‚¹ã‚¿ç³» |
| ä½œæˆæ—¥ | 2025-06-01 |

> **æ³¨æ„**: æœ¬ãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©æ›¸ã¯è‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã™ã€‚æ‰‹å‹•ç·¨é›†ã¯è¡Œã‚ãªã„ã§ãã ã•ã„ã€‚
> è©³ç´°å®šç¾©ã®å¤‰æ›´ã¯ `table-details/MST_UserAuth_details.yaml` ã§è¡Œã£ã¦ãã ã•ã„ã€‚



## ğŸ“ ãƒ†ãƒ¼ãƒ–ãƒ«æ¦‚è¦

MST_UserAuthï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼æƒ…å ±ï¼‰ã¯ã€ã‚·ã‚¹ãƒ†ãƒ ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®èªè¨¼ãƒ»èªå¯æƒ…å ±ã‚’ç®¡ç†ã™ã‚‹ãƒã‚¹ã‚¿ãƒ†ãƒ¼ãƒ–ãƒ«ã§ã™ã€‚

ä¸»ãªç›®çš„ï¼š
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ä¸€å…ƒç®¡ç†ï¼ˆãƒ­ã‚°ã‚¤ãƒ³IDã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç­‰ï¼‰
- èªè¨¼æƒ…å ±ã®ã‚»ã‚­ãƒ¥ã‚¢ãªä¿å­˜ï¼ˆãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥åŒ–ã€å¤šè¦ç´ èªè¨¼å¯¾å¿œï¼‰
- ã‚¢ã‚«ã‚¦ãƒ³ãƒˆçŠ¶æ…‹ç®¡ç†ï¼ˆæœ‰åŠ¹/ç„¡åŠ¹ã€ãƒ­ãƒƒã‚¯çŠ¶æ…‹ç­‰ï¼‰
- ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ãƒ»ãƒˆãƒ¼ã‚¯ãƒ³ç®¡ç†
- ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒªã‚·ãƒ¼ã®é©ç”¨ãƒ»ç®¡ç†
- ãƒ­ã‚°ã‚¤ãƒ³å±¥æ­´ãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£æŸ»
- å¤–éƒ¨èªè¨¼ã‚·ã‚¹ãƒ†ãƒ é€£æºï¼ˆSSOã€LDAPç­‰ï¼‰

ã“ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã¯ã€ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®åŸºç›¤ã¨ãªã‚Šã€ä¸æ­£ã‚¢ã‚¯ã‚»ã‚¹é˜²æ­¢ã€
å€‹äººæƒ…å ±ä¿è­·ã€ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹å¯¾å¿œã«ãŠã„ã¦é‡è¦ãªå½¹å‰²ã‚’æœãŸã—ã¾ã™ã€‚


## ğŸ—‚ï¸ ã‚«ãƒ©ãƒ å®šç¾©

| ã‚«ãƒ©ãƒ å | è«–ç†å | ãƒ‡ãƒ¼ã‚¿å‹ | æ¡æ•° | NULL | PK | FK | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ | èª¬æ˜ |
|----------|--------|----------|------|------|----|----|------------|------|
| id | ID | VARCHAR | 50 | Ã— | â— |  |  | ãƒ—ãƒ©ã‚¤ãƒãƒªã‚­ãƒ¼ï¼ˆUUIDï¼‰ |
| is_deleted | å‰Šé™¤ãƒ•ãƒ©ã‚° | BOOLEAN |  | Ã— |  |  |  | è«–ç†å‰Šé™¤ãƒ•ãƒ©ã‚° |
| tenant_id | ãƒ†ãƒŠãƒ³ãƒˆID | VARCHAR | 50 | Ã— |  |  |  | ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆè­˜åˆ¥å­ |
| user_id | ãƒ¦ãƒ¼ã‚¶ãƒ¼ID | VARCHAR | 50 | â—‹ |  |  |  | ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä¸€æ„ã«è­˜åˆ¥ã™ã‚‹IDï¼ˆä¾‹ï¼šUSER000001ï¼‰ |
| login_id | ãƒ­ã‚°ã‚¤ãƒ³ID | VARCHAR | 100 | â—‹ |  |  |  | ãƒ­ã‚°ã‚¤ãƒ³æ™‚ã«ä½¿ç”¨ã™ã‚‹IDï¼ˆé€šå¸¸ã¯ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼‰ |
| password_hash | ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥ | VARCHAR | 255 | â—‹ |  |  |  | ãƒãƒƒã‚·ãƒ¥åŒ–ã•ã‚ŒãŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼ˆbcryptç­‰ï¼‰ |
| password_salt | ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚½ãƒ«ãƒˆ | VARCHAR | 100 | â—‹ |  |  |  | ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥åŒ–ç”¨ã®ã‚½ãƒ«ãƒˆå€¤ |
| employee_id | ç¤¾å“¡ID | VARCHAR | 50 | â—‹ |  | â— |  | é–¢é€£ã™ã‚‹ç¤¾å“¡ã®IDï¼ˆMST_Employeeã¸ã®å¤–éƒ¨ã‚­ãƒ¼ï¼‰ |
| account_status | ã‚¢ã‚«ã‚¦ãƒ³ãƒˆçŠ¶æ…‹ | ENUM |  | â—‹ |  |  | ACTIVE | ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®çŠ¶æ…‹ï¼ˆACTIVE:æœ‰åŠ¹ã€INACTIVE:ç„¡åŠ¹ã€LOCKED:ãƒ­ãƒƒã‚¯ã€SUSPENDED:åœæ­¢ï¼‰ |
| last_login_at | æœ€çµ‚ãƒ­ã‚°ã‚¤ãƒ³æ—¥æ™‚ | TIMESTAMP |  | â—‹ |  |  |  | æœ€å¾Œã«ãƒ­ã‚°ã‚¤ãƒ³ã—ãŸæ—¥æ™‚ |
| last_login_ip | æœ€çµ‚ãƒ­ã‚°ã‚¤ãƒ³IP | VARCHAR | 45 | â—‹ |  |  |  | æœ€å¾Œã«ãƒ­ã‚°ã‚¤ãƒ³ã—ãŸIPã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ˆIPv4/IPv6å¯¾å¿œï¼‰ |
| failed_login_count | ãƒ­ã‚°ã‚¤ãƒ³å¤±æ•—å›æ•° | INT |  | â—‹ |  |  |  | é€£ç¶šãƒ­ã‚°ã‚¤ãƒ³å¤±æ•—å›æ•°ï¼ˆã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ­ãƒƒã‚¯åˆ¤å®šç”¨ï¼‰ |
| last_failed_login_at | æœ€çµ‚ãƒ­ã‚°ã‚¤ãƒ³å¤±æ•—æ—¥æ™‚ | TIMESTAMP |  | â—‹ |  |  |  | æœ€å¾Œã«ãƒ­ã‚°ã‚¤ãƒ³ã«å¤±æ•—ã—ãŸæ—¥æ™‚ |
| password_changed_at | ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´æ—¥æ™‚ | TIMESTAMP |  | â—‹ |  |  |  | ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’æœ€å¾Œã«å¤‰æ›´ã—ãŸæ—¥æ™‚ |
| password_expires_at | ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰æœ‰åŠ¹æœŸé™ | TIMESTAMP |  | â—‹ |  |  |  | ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®æœ‰åŠ¹æœŸé™ |
| mfa_enabled | å¤šè¦ç´ èªè¨¼æœ‰åŠ¹ | BOOLEAN |  | â—‹ |  |  |  | å¤šè¦ç´ èªè¨¼ãŒæœ‰åŠ¹ã‹ã©ã†ã‹ |
| mfa_secret | å¤šè¦ç´ èªè¨¼ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆ | VARCHAR | 255 | â—‹ |  |  |  | TOTPç­‰ã®å¤šè¦ç´ èªè¨¼ç”¨ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚­ãƒ¼ |
| recovery_token | å¾©æ—§ãƒˆãƒ¼ã‚¯ãƒ³ | VARCHAR | 255 | â—‹ |  |  |  | ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆç­‰ã®å¾©æ—§ç”¨ãƒˆãƒ¼ã‚¯ãƒ³ |
| recovery_token_expires_at | å¾©æ—§ãƒˆãƒ¼ã‚¯ãƒ³æœ‰åŠ¹æœŸé™ | TIMESTAMP |  | â—‹ |  |  |  | å¾©æ—§ãƒˆãƒ¼ã‚¯ãƒ³ã®æœ‰åŠ¹æœŸé™ |
| session_timeout | ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ | INT |  | â—‹ |  |  |  | ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆæ™‚é–“ï¼ˆåˆ†ï¼‰ |
| external_auth_provider | å¤–éƒ¨èªè¨¼ãƒ—ãƒ­ãƒã‚¤ãƒ€ | VARCHAR | 50 | â—‹ |  |  |  | å¤–éƒ¨èªè¨¼ãƒ—ãƒ­ãƒã‚¤ãƒ€ï¼ˆLDAPã€SAMLã€OAuthç­‰ï¼‰ |
| external_auth_id | å¤–éƒ¨èªè¨¼ID | VARCHAR | 255 | â—‹ |  |  |  | å¤–éƒ¨èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ã§ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ID |
| created_at | ä½œæˆæ—¥æ™‚ | TIMESTAMP |  | Ã— |  |  | CURRENT_TIMESTAMP | ãƒ¬ã‚³ãƒ¼ãƒ‰ä½œæˆæ—¥æ™‚ |
| updated_at | æ›´æ–°æ—¥æ™‚ | TIMESTAMP |  | Ã— |  |  | CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | ãƒ¬ã‚³ãƒ¼ãƒ‰æ›´æ–°æ—¥æ™‚ |
| created_by | ä½œæˆè€… | VARCHAR | 50 | Ã— |  |  |  | ãƒ¬ã‚³ãƒ¼ãƒ‰ä½œæˆè€…ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ID |
| updated_by | æ›´æ–°è€… | VARCHAR | 50 | Ã— |  |  |  | ãƒ¬ã‚³ãƒ¼ãƒ‰æ›´æ–°è€…ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ID |

## ğŸ” ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹å®šç¾©

| ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹å | ã‚«ãƒ©ãƒ  | ãƒ¦ãƒ‹ãƒ¼ã‚¯ | èª¬æ˜ |
|----------------|--------|----------|------|
| idx_user_id | user_id | â—‹ | ãƒ¦ãƒ¼ã‚¶ãƒ¼IDæ¤œç´¢ç”¨ï¼ˆä¸€æ„ï¼‰ |
| idx_login_id | login_id | â—‹ | ãƒ­ã‚°ã‚¤ãƒ³IDæ¤œç´¢ç”¨ï¼ˆä¸€æ„ï¼‰ |
| idx_employee_id | employee_id | â—‹ | ç¤¾å“¡IDæ¤œç´¢ç”¨ï¼ˆä¸€æ„ï¼‰ |
| idx_account_status | account_status | Ã— | ã‚¢ã‚«ã‚¦ãƒ³ãƒˆçŠ¶æ…‹åˆ¥æ¤œç´¢ç”¨ |
| idx_last_login | last_login_at | Ã— | æœ€çµ‚ãƒ­ã‚°ã‚¤ãƒ³æ—¥æ™‚æ¤œç´¢ç”¨ |
| idx_password_expires | password_expires_at | Ã— | ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰æœ‰åŠ¹æœŸé™æ¤œç´¢ç”¨ |
| idx_external_auth | external_auth_provider, external_auth_id | Ã— | å¤–éƒ¨èªè¨¼æ¤œç´¢ç”¨ |

## ğŸ”’ åˆ¶ç´„å®šç¾©

| åˆ¶ç´„å | åˆ¶ç´„ã‚¿ã‚¤ãƒ— | å¯¾è±¡ã‚«ãƒ©ãƒ  | æ¡ä»¶ | èª¬æ˜ |
|--------|------------|------------|------|------|
| uk_user_id | UNIQUE | user_id |  | ãƒ¦ãƒ¼ã‚¶ãƒ¼IDä¸€æ„åˆ¶ç´„ |
| uk_login_id | UNIQUE | login_id |  | ãƒ­ã‚°ã‚¤ãƒ³IDä¸€æ„åˆ¶ç´„ |
| uk_employee_id | UNIQUE | employee_id |  | ç¤¾å“¡IDä¸€æ„åˆ¶ç´„ |
| chk_account_status | CHECK |  | account_status IN ('ACTIVE', 'INACTIVE', 'LOCKED', 'SUSPENDED') | ã‚¢ã‚«ã‚¦ãƒ³ãƒˆçŠ¶æ…‹å€¤ãƒã‚§ãƒƒã‚¯åˆ¶ç´„ |
| chk_failed_login_count | CHECK |  | failed_login_count >= 0 | ãƒ­ã‚°ã‚¤ãƒ³å¤±æ•—å›æ•°éè² å€¤ãƒã‚§ãƒƒã‚¯åˆ¶ç´„ |
| chk_session_timeout | CHECK |  | session_timeout IS NULL OR session_timeout > 0 | ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆæ­£å€¤ãƒã‚§ãƒƒã‚¯åˆ¶ç´„ |

## ğŸ”— å¤–éƒ¨ã‚­ãƒ¼é–¢ä¿‚

| å¤–éƒ¨ã‚­ãƒ¼å | ã‚«ãƒ©ãƒ  | å‚ç…§ãƒ†ãƒ¼ãƒ–ãƒ« | å‚ç…§ã‚«ãƒ©ãƒ  | æ›´æ–°æ™‚ | å‰Šé™¤æ™‚ | èª¬æ˜ |
|------------|--------|--------------|------------|--------|--------|------|
| fk_userauth_employee | employee_id | MST_Employee | id | CASCADE | SET NULL | ç¤¾å“¡ã¸ã®å¤–éƒ¨ã‚­ãƒ¼ |

## ğŸ“Š ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿

```json
[
  {
    "user_id": "USER000001",
    "login_id": "yamada.taro@company.com",
    "password_hash": "$2b$12$LQv3c1yqBWVHxkd0LHAkCOYz6TtxMQJqhN8/LewdBPj/RK.s5uIoS",
    "password_salt": "randomsalt123",
    "employee_id": "EMP000001",
    "account_status": "ACTIVE",
    "last_login_at": "2025-06-01 09:00:00",
    "last_login_ip": "192.168.1.100",
    "failed_login_count": 0,
    "last_failed_login_at": null,
    "password_changed_at": "2025-01-01 00:00:00",
    "password_expires_at": "2025-12-31 23:59:59",
    "mfa_enabled": true,
    "mfa_secret": "JBSWY3DPEHPK3PXP",
    "recovery_token": null,
    "recovery_token_expires_at": null,
    "session_timeout": 480,
    "external_auth_provider": null,
    "external_auth_id": null
  },
  {
    "user_id": "USER000002",
    "login_id": "sato.hanako@company.com",
    "password_hash": "$2b$12$XQv3c1yqBWVHxkd0LHAkCOYz6TtxMQJqhN8/LewdBPj/RK.s5uIoX",
    "password_salt": "randomsalt456",
    "employee_id": "EMP000002",
    "account_status": "ACTIVE",
    "last_login_at": "2025-05-31 17:30:00",
    "last_login_ip": "192.168.1.101",
    "failed_login_count": 0,
    "last_failed_login_at": null,
    "password_changed_at": "2025-02-01 00:00:00",
    "password_expires_at": "2026-01-31 23:59:59",
    "mfa_enabled": false,
    "mfa_secret": null,
    "recovery_token": null,
    "recovery_token_expires_at": null,
    "session_timeout": 240,
    "external_auth_provider": null,
    "external_auth_id": null
  }
]
```

## ğŸ“Œ ç‰¹è¨˜äº‹é …

- ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯å¿…ãšãƒãƒƒã‚·ãƒ¥åŒ–ã—ã¦ä¿å­˜ï¼ˆå¹³æ–‡ä¿å­˜ç¦æ­¢ï¼‰
- å€‹äººæƒ…å ±ä¿è­·ã®ãŸã‚æ©Ÿå¯†æƒ…å ±ã¯æš—å·åŒ–
- ãƒ­ã‚°ã‚¤ãƒ³å¤±æ•—å›æ•°ã«ã‚ˆã‚‹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ­ãƒƒã‚¯æ©Ÿèƒ½
- å¤šè¦ç´ èªè¨¼ï¼ˆMFAï¼‰å¯¾å¿œ
- å¤–éƒ¨èªè¨¼ã‚·ã‚¹ãƒ†ãƒ é€£æºå¯¾å¿œ
- ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰æœ‰åŠ¹æœŸé™ç®¡ç†
- ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆå€‹åˆ¥è¨­å®šå¯èƒ½

## ğŸ“‹ æ¥­å‹™ãƒ«ãƒ¼ãƒ«

- ãƒ­ã‚°ã‚¤ãƒ³å¤±æ•—5å›ã§ã‚¢ã‚«ã‚¦ãƒ³ãƒˆè‡ªå‹•ãƒ­ãƒƒã‚¯
- ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯90æ—¥ã§æœ‰åŠ¹æœŸé™åˆ‡ã‚Œ
- ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯éå»3å›åˆ†ã¨åŒã˜ã‚‚ã®ã¯ä½¿ç”¨ä¸å¯
- ç®¡ç†è€…æ¨©é™ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯å¤šè¦ç´ èªè¨¼å¿…é ˆ
- å¤–éƒ¨èªè¨¼ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç®¡ç†ä¸è¦
- ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ­ãƒƒã‚¯è§£é™¤ã¯ç®¡ç†è€…ã®ã¿å¯èƒ½
- å¾©æ—§ãƒˆãƒ¼ã‚¯ãƒ³ã®æœ‰åŠ¹æœŸé™ã¯24æ™‚é–“
- ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯8æ™‚é–“
