# ãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©æ›¸: HIS_TenantBilling (ãƒ†ãƒŠãƒ³ãƒˆèª²é‡‘å±¥æ­´)

## ðŸ“‹ åŸºæœ¬æƒ…å ±

| é …ç›® | å†…å®¹ |
|------|------|
| ãƒ†ãƒ¼ãƒ–ãƒ«å | HIS_TenantBilling |
| è«–ç†å | ãƒ†ãƒŠãƒ³ãƒˆèª²é‡‘å±¥æ­´ |
| ã‚«ãƒ†ã‚´ãƒª | å±¥æ­´ç³» |
| ä½œæˆæ—¥ | 2025-06-01 |

> **æ³¨æ„**: æœ¬ãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©æ›¸ã¯è‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã™ã€‚æ‰‹å‹•ç·¨é›†ã¯è¡Œã‚ãªã„ã§ãã ã•ã„ã€‚
> è©³ç´°å®šç¾©ã®å¤‰æ›´ã¯ `table-details/HIS_TenantBilling_details.yaml` ã§è¡Œã£ã¦ãã ã•ã„ã€‚


## ðŸ“ æ”¹ç‰ˆå±¥æ­´

> **æ³¨æ„**: æ”¹ç‰ˆå±¥æ­´ã®è©³ç´°ã¯ä»¥ä¸‹ã®YAMLãƒ•ã‚¡ã‚¤ãƒ«ã§ç®¡ç†ã•ã‚Œã¦ã„ã¾ã™ï¼š
> `table-details/TABLE_NAME_details.yaml`

| ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | æ›´æ–°æ—¥ | æ›´æ–°è€… | ä¸»ãªå¤‰æ›´å†…å®¹ |
|------------|--------|--------|-------------|
| 1.0.0 | 2025-06-01 | é–‹ç™ºãƒãƒ¼ãƒ  | åˆç‰ˆä½œæˆ - ãƒ†ãƒŠãƒ³ãƒˆèª²é‡‘å±¥æ­´ãƒ†ãƒ¼ãƒ–ãƒ«ã®è©³ç´°å®šç¾© |


## ðŸ“ ãƒ†ãƒ¼ãƒ–ãƒ«æ¦‚è¦

HIS_TenantBillingï¼ˆãƒ†ãƒŠãƒ³ãƒˆèª²é‡‘å±¥æ­´ï¼‰ã¯ã€ãƒžãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ ã«ãŠã‘ã‚‹å„ãƒ†ãƒŠãƒ³ãƒˆã®èª²é‡‘æƒ…å ±ã‚’å±¥æ­´ã¨ã—ã¦ç®¡ç†ã™ã‚‹ãƒ†ãƒ¼ãƒ–ãƒ«ã§ã™ã€‚

ä¸»ãªç›®çš„ï¼š
- ãƒ†ãƒŠãƒ³ãƒˆåˆ¥èª²é‡‘å±¥æ­´ã®ç®¡ç†
- ä½¿ç”¨é‡ãƒ™ãƒ¼ã‚¹èª²é‡‘ã®è¨ˆç®—å±¥æ­´
- è«‹æ±‚æ›¸ç™ºè¡Œã®ãŸã‚ã®åŸºç¤Žãƒ‡ãƒ¼ã‚¿ç®¡ç†
- èª²é‡‘ç›£æŸ»ã®ãŸã‚ã®è¨¼è·¡ç®¡ç†
- åŽç›Šåˆ†æžã®ãŸã‚ã®ãƒ‡ãƒ¼ã‚¿è“„ç©

ã“ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã¯ã€ãƒžãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆç®¡ç†æ©Ÿèƒ½ã«ãŠã„ã¦èª²é‡‘ãƒ»è«‹æ±‚æ¥­å‹™ã‚’æ”¯ãˆã‚‹é‡è¦ãªå±¥æ­´ãƒ‡ãƒ¼ã‚¿ã§ã™ã€‚


## ðŸ—‚ï¸ ã‚«ãƒ©ãƒ å®šç¾©

| ã‚«ãƒ©ãƒ å | è«–ç†å | ãƒ‡ãƒ¼ã‚¿åž‹ | æ¡æ•° | NULL | PK | FK | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ | èª¬æ˜Ž |
|----------|--------|----------|------|------|----|----|------------|------|
| id | ID | VARCHAR | 50 | Ã— | â— |  |  | ãƒ—ãƒ©ã‚¤ãƒžãƒªã‚­ãƒ¼ï¼ˆUUIDï¼‰ |
| is_deleted | å‰Šé™¤ãƒ•ãƒ©ã‚° | BOOLEAN |  | Ã— |  |  |  | è«–ç†å‰Šé™¤ãƒ•ãƒ©ã‚° |
| tenant_id | ãƒ†ãƒŠãƒ³ãƒˆID | VARCHAR | 50 | Ã— |  | â— |  | ãƒžãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆè­˜åˆ¥å­ |
| id | ID | VARCHAR | 50 | â—‹ |  |  |  | ãƒ—ãƒ©ã‚¤ãƒžãƒªã‚­ãƒ¼ï¼ˆUUIDï¼‰ |
| tenant_id | ãƒ†ãƒŠãƒ³ãƒˆID | VARCHAR | 50 | â—‹ |  | â— |  | èª²é‡‘å¯¾è±¡ã®ãƒ†ãƒŠãƒ³ãƒˆIDï¼ˆMST_Tenantã¸ã®å‚ç…§ï¼‰ |
| billing_period_start | èª²é‡‘æœŸé–“é–‹å§‹æ—¥ | DATE |  | â—‹ |  |  |  | èª²é‡‘æœŸé–“ã®é–‹å§‹æ—¥ |
| billing_period_end | èª²é‡‘æœŸé–“çµ‚äº†æ—¥ | DATE |  | â—‹ |  |  |  | èª²é‡‘æœŸé–“ã®çµ‚äº†æ—¥ |
| billing_type | èª²é‡‘ã‚¿ã‚¤ãƒ— | ENUM |  | â—‹ |  |  |  | èª²é‡‘ã®ç¨®é¡žï¼ˆMONTHLY:æœˆé¡ã€USAGE:å¾“é‡ã€SETUP:åˆæœŸè²»ç”¨ã€ADDITIONAL:è¿½åŠ è²»ç”¨ï¼‰ |
| plan_id | ãƒ—ãƒ©ãƒ³ID | VARCHAR | 50 | â—‹ |  |  |  | é©ç”¨ã•ã‚ŒãŸãƒ—ãƒ©ãƒ³ã®ID |
| plan_name | ãƒ—ãƒ©ãƒ³å | VARCHAR | 200 | â—‹ |  |  |  | é©ç”¨ã•ã‚ŒãŸãƒ—ãƒ©ãƒ³ã®åç§° |
| base_amount | åŸºæœ¬æ–™é‡‘ | DECIMAL | 12,2 | â—‹ |  |  |  | åŸºæœ¬æ–™é‡‘ï¼ˆç¨ŽæŠœï¼‰ |
| usage_amount | å¾“é‡æ–™é‡‘ | DECIMAL | 12,2 | â—‹ |  |  |  | ä½¿ç”¨é‡ã«åŸºã¥ãå¾“é‡æ–™é‡‘ï¼ˆç¨ŽæŠœï¼‰ |
| additional_amount | è¿½åŠ æ–™é‡‘ | DECIMAL | 12,2 | â—‹ |  |  |  | è¿½åŠ ã‚µãƒ¼ãƒ“ã‚¹ç­‰ã®æ–™é‡‘ï¼ˆç¨ŽæŠœï¼‰ |
| discount_amount | å‰²å¼•é‡‘é¡ | DECIMAL | 12,2 | â—‹ |  |  |  | é©ç”¨ã•ã‚ŒãŸå‰²å¼•é‡‘é¡ï¼ˆç¨ŽæŠœï¼‰ |
| subtotal_amount | å°è¨ˆé‡‘é¡ | DECIMAL | 12,2 | â—‹ |  |  |  | ç¨ŽæŠœå°è¨ˆé‡‘é¡ |
| tax_rate | ç¨ŽçŽ‡ | DECIMAL | 5,3 | â—‹ |  |  |  | é©ç”¨ã•ã‚ŒãŸç¨ŽçŽ‡ï¼ˆä¾‹ï¼š0.100 = 10%ï¼‰ |
| tax_amount | ç¨Žé¡ | DECIMAL | 12,2 | â—‹ |  |  |  | æ¶ˆè²»ç¨Žé¡ |
| total_amount | åˆè¨ˆé‡‘é¡ | DECIMAL | 12,2 | â—‹ |  |  |  | ç¨Žè¾¼åˆè¨ˆé‡‘é¡ |
| currency_code | é€šè²¨ã‚³ãƒ¼ãƒ‰ | VARCHAR | 3 | â—‹ |  |  | JPY | é€šè²¨ã‚³ãƒ¼ãƒ‰ï¼ˆISO 4217æº–æ‹ ã€ä¾‹ï¼šJPYã€USDï¼‰ |
| usage_details | ä½¿ç”¨é‡è©³ç´° | TEXT |  | â—‹ |  |  |  | ä½¿ç”¨é‡ã®è©³ç´°æƒ…å ±ï¼ˆJSONå½¢å¼ï¼‰ |
| billing_status | èª²é‡‘çŠ¶æ…‹ | ENUM |  | â—‹ |  |  | CALCULATED | èª²é‡‘ã®çŠ¶æ…‹ï¼ˆCALCULATED:è¨ˆç®—æ¸ˆã¿ã€INVOICED:è«‹æ±‚æ¸ˆã¿ã€PAID:æ”¯æ‰•æ¸ˆã¿ã€CANCELLED:ã‚­ãƒ£ãƒ³ã‚»ãƒ«ï¼‰ |
| invoice_number | è«‹æ±‚æ›¸ç•ªå· | VARCHAR | 50 | â—‹ |  |  |  | ç™ºè¡Œã•ã‚ŒãŸè«‹æ±‚æ›¸ã®ç•ªå· |
| invoice_date | è«‹æ±‚æ—¥ | DATE |  | â—‹ |  |  |  | è«‹æ±‚æ›¸ã®ç™ºè¡Œæ—¥ |
| due_date | æ”¯æ‰•æœŸé™ | DATE |  | â—‹ |  |  |  | æ”¯æ‰•æœŸé™æ—¥ |
| paid_date | æ”¯æ‰•æ—¥ | DATE |  | â—‹ |  |  |  | å®Ÿéš›ã®æ”¯æ‰•æ—¥ |
| payment_method | æ”¯æ‰•æ–¹æ³• | ENUM |  | â—‹ |  |  |  | æ”¯æ‰•æ–¹æ³•ï¼ˆCREDIT_CARD:ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰ã€BANK_TRANSFER:éŠ€è¡ŒæŒ¯è¾¼ã€AUTO_DEBIT:è‡ªå‹•å¼•è½ï¼‰ |
| notes | å‚™è€ƒ | TEXT |  | â—‹ |  |  |  | èª²é‡‘ã«é–¢ã™ã‚‹å‚™è€ƒãƒ»ç‰¹è¨˜äº‹é … |
| created_at | ä½œæˆæ—¥æ™‚ | TIMESTAMP |  | Ã— |  |  | CURRENT_TIMESTAMP | ãƒ¬ã‚³ãƒ¼ãƒ‰ä½œæˆæ—¥æ™‚ |
| updated_at | æ›´æ–°æ—¥æ™‚ | TIMESTAMP |  | Ã— |  |  | CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | ãƒ¬ã‚³ãƒ¼ãƒ‰æ›´æ–°æ—¥æ™‚ |
| created_by | ä½œæˆè€… | VARCHAR | 50 | Ã— |  |  |  | ãƒ¬ã‚³ãƒ¼ãƒ‰ä½œæˆè€…ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ID |
| updated_by | æ›´æ–°è€… | VARCHAR | 50 | Ã— |  |  |  | ãƒ¬ã‚³ãƒ¼ãƒ‰æ›´æ–°è€…ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ID |

## ðŸ” ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹å®šç¾©

| ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹å | ã‚«ãƒ©ãƒ  | ãƒ¦ãƒ‹ãƒ¼ã‚¯ | èª¬æ˜Ž |
|----------------|--------|----------|------|
| idx_tenant_billing_tenant_period | tenant_id, billing_period_start, billing_period_end | Ã— | ãƒ†ãƒŠãƒ³ãƒˆåˆ¥èª²é‡‘æœŸé–“æ¤œç´¢ç”¨ |
| idx_tenant_billing_status | billing_status | Ã— | èª²é‡‘çŠ¶æ…‹åˆ¥æ¤œç´¢ç”¨ |
| idx_tenant_billing_invoice | invoice_number | â—‹ | è«‹æ±‚æ›¸ç•ªå·æ¤œç´¢ç”¨ï¼ˆä¸€æ„ï¼‰ |
| idx_tenant_billing_dates | invoice_date, due_date, paid_date | Ã— | æ—¥ä»˜åˆ¥æ¤œç´¢ç”¨ |
| idx_tenant_billing_type | billing_type | Ã— | èª²é‡‘ã‚¿ã‚¤ãƒ—åˆ¥æ¤œç´¢ç”¨ |
| idx_tenant_billing_amount | total_amount | Ã— | é‡‘é¡åˆ¥æ¤œç´¢ç”¨ |

## ðŸ”’ åˆ¶ç´„å®šç¾©

| åˆ¶ç´„å | åˆ¶ç´„ã‚¿ã‚¤ãƒ— | å¯¾è±¡ã‚«ãƒ©ãƒ  | æ¡ä»¶ | èª¬æ˜Ž |
|--------|------------|------------|------|------|
| uk_tenant_billing_invoice | UNIQUE | invoice_number |  | è«‹æ±‚æ›¸ç•ªå·ä¸€æ„åˆ¶ç´„ |
| chk_tenant_billing_type | CHECK |  | billing_type IN ('MONTHLY', 'USAGE', 'SETUP', 'ADDITIONAL') | èª²é‡‘ã‚¿ã‚¤ãƒ—å€¤ãƒã‚§ãƒƒã‚¯åˆ¶ç´„ |
| chk_tenant_billing_status | CHECK |  | billing_status IN ('CALCULATED', 'INVOICED', 'PAID', 'CANCELLED') | èª²é‡‘çŠ¶æ…‹å€¤ãƒã‚§ãƒƒã‚¯åˆ¶ç´„ |
| chk_tenant_billing_payment_method | CHECK |  | payment_method IS NULL OR payment_method IN ('CREDIT_CARD', 'BANK_TRANSFER', 'AUTO_DEBIT') | æ”¯æ‰•æ–¹æ³•å€¤ãƒã‚§ãƒƒã‚¯åˆ¶ç´„ |
| chk_tenant_billing_period | CHECK |  | billing_period_end >= billing_period_start | èª²é‡‘æœŸé–“æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯åˆ¶ç´„ |
| chk_tenant_billing_amounts_positive | CHECK |  | base_amount >= 0 AND usage_amount >= 0 AND additional_amount >= 0 AND discount_amount >= 0 AND tax_amount >= 0 AND total_amount >= 0 | é‡‘é¡æ­£æ•°ãƒã‚§ãƒƒã‚¯åˆ¶ç´„ |
| chk_tenant_billing_tax_rate | CHECK |  | tax_rate >= 0 AND tax_rate <= 1 | ç¨ŽçŽ‡ç¯„å›²ãƒã‚§ãƒƒã‚¯åˆ¶ç´„ |

## ðŸ”— å¤–éƒ¨ã‚­ãƒ¼é–¢ä¿‚

| å¤–éƒ¨ã‚­ãƒ¼å | ã‚«ãƒ©ãƒ  | å‚ç…§ãƒ†ãƒ¼ãƒ–ãƒ« | å‚ç…§ã‚«ãƒ©ãƒ  | æ›´æ–°æ™‚ | å‰Šé™¤æ™‚ | èª¬æ˜Ž |
|------------|--------|--------------|------------|--------|--------|------|
| fk_tenant_billing_tenant | tenant_id | MST_Tenant | id | CASCADE | RESTRICT | ãƒ†ãƒŠãƒ³ãƒˆç®¡ç†ã¸ã®å¤–éƒ¨ã‚­ãƒ¼ |

## ðŸ“Š ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿

```json
[
  {
    "id": "TB001",
    "tenant_id": "TENANT001",
    "billing_period_start": "2025-05-01",
    "billing_period_end": "2025-05-31",
    "billing_type": "MONTHLY",
    "plan_id": "PLAN_STANDARD",
    "plan_name": "ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰ãƒ—ãƒ©ãƒ³",
    "base_amount": 50000.0,
    "usage_amount": 15000.0,
    "additional_amount": 5000.0,
    "discount_amount": 3000.0,
    "subtotal_amount": 67000.0,
    "tax_rate": 0.1,
    "tax_amount": 6700.0,
    "total_amount": 73700.0,
    "currency_code": "JPY",
    "usage_details": "{\"users\": 25, \"storage_gb\": 150, \"api_calls\": 50000}",
    "billing_status": "PAID",
    "invoice_number": "INV-2025-05-001",
    "invoice_date": "2025-06-01",
    "due_date": "2025-06-30",
    "paid_date": "2025-06-15",
    "payment_method": "CREDIT_CARD",
    "notes": "5æœˆåˆ†æœˆé¡åˆ©ç”¨æ–™é‡‘"
  },
  {
    "id": "TB002",
    "tenant_id": "TENANT002",
    "billing_period_start": "2025-05-01",
    "billing_period_end": "2025-05-31",
    "billing_type": "USAGE",
    "plan_id": "PLAN_ENTERPRISE",
    "plan_name": "ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºãƒ—ãƒ©ãƒ³",
    "base_amount": 100000.0,
    "usage_amount": 45000.0,
    "additional_amount": 0.0,
    "discount_amount": 10000.0,
    "subtotal_amount": 135000.0,
    "tax_rate": 0.1,
    "tax_amount": 13500.0,
    "total_amount": 148500.0,
    "currency_code": "JPY",
    "usage_details": "{\"users\": 100, \"storage_gb\": 500, \"api_calls\": 200000, \"premium_features\": true}",
    "billing_status": "INVOICED",
    "invoice_number": "INV-2025-05-002",
    "invoice_date": "2025-06-01",
    "due_date": "2025-06-30",
    "paid_date": null,
    "payment_method": "BANK_TRANSFER",
    "notes": "5æœˆåˆ†å¾“é‡èª²é‡‘ï¼ˆå¤§å®¹é‡åˆ©ç”¨ï¼‰"
  }
]
```

## ðŸ“Œ ç‰¹è¨˜äº‹é …

- èª²é‡‘å±¥æ­´ã¯æ³•çš„è¦ä»¶ã«ã‚ˆã‚Š7å¹´é–“ä¿æŒã•ã‚Œã‚‹
- é‡‘é¡ã¯å…¨ã¦ç¨ŽæŠœãƒ»ç¨Žè¾¼ã‚’æ˜Žç¢ºã«åˆ†é›¢ã—ã¦ç®¡ç†
- ä½¿ç”¨é‡è©³ç´°ã¯JSONå½¢å¼ã§æŸ”è»Ÿãªæƒ…å ±ã‚’æ ¼ç´
- è«‹æ±‚æ›¸ç•ªå·ã¯å…¨ã‚·ã‚¹ãƒ†ãƒ ã§ä¸€æ„ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚‹
- æ”¯æ‰•çŠ¶æ³ã¯å¤–éƒ¨æ±ºæ¸ˆã‚·ã‚¹ãƒ†ãƒ ã¨ã®é€£æºã«ã‚ˆã‚Šæ›´æ–°
- é€šè²¨ã‚³ãƒ¼ãƒ‰ã¯ISO 4217æº–æ‹ ã§å›½éš›åŒ–ã«å¯¾å¿œ
- å€‹äººæƒ…å ±å«æœ‰ã®ãŸã‚æš—å·åŒ–å¿…é ˆï¼ˆãƒ†ãƒ¼ãƒ–ãƒ«ä¸€è¦§å‚ç…§ï¼‰

## ðŸ“‹ æ¥­å‹™ãƒ«ãƒ¼ãƒ«

- èª²é‡‘æœŸé–“ã¯é‡è¤‡ã—ãªã„é€£ç¶šã—ãŸæœŸé–“ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚‹
- è«‹æ±‚æ›¸ç•ªå·ã¯ç™ºè¡Œå¾Œå¤‰æ›´ä¸å¯
- æ”¯æ‰•æ¸ˆã¿çŠ¶æ…‹ã®èª²é‡‘æƒ…å ±ã¯å¤‰æ›´ä¸å¯
- ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚ŒãŸèª²é‡‘ã¯é‡‘é¡ã‚’0ã«èª¿æ•´
- ç¨ŽçŽ‡ã¯èª²é‡‘æœŸé–“ã®æ³•å®šç¨ŽçŽ‡ã‚’é©ç”¨
- ä½¿ç”¨é‡ãƒ™ãƒ¼ã‚¹èª²é‡‘ã¯å®Ÿéš›ã®ä½¿ç”¨é‡ãƒ‡ãƒ¼ã‚¿ã«åŸºã¥ã
- å‰²å¼•ã¯å¥‘ç´„æ¡ä»¶ã«åŸºã¥ãè‡ªå‹•é©ç”¨
- æ”¯æ‰•æœŸé™ã¯è«‹æ±‚æ—¥ã‹ã‚‰30æ—¥å¾ŒãŒæ¨™æº–
