# 年間スキル報告書WEB化PJT - 統合開発ルール

## .clinerules 構成

### ファイル構成
```
.clinerules/
├── .clinerules                        # Clineメモリーバンク設定
├── 00-core-rules.md                   # 統合開発ルール（本ファイル）
├── 01-project-specific-rules.md       # プロジェクト固有ルール
├── 02-coding-standards.md             # コーディング規約
├── 03-frontend-guidelines.md          # フロントエンド設計ガイドライン
├── 04-backend-guidelines.md           # バックエンド設計ガイドライン
├── 05-git-workflow.md                 # Git・バージョン管理ワークフロー
├── 06-multitenant-development.md     # マルチテナント開発ガイドライン
├── 07-specification-compliance.md    # 仕様書準拠・破壊的修正防止
└── .archived/                         # アーカイブファイル
```

### 各ファイルの役割
- **00-core-rules.md**: 全体統括・基本方針・重要事項の集約
- **01-project-specific-rules.md**: 年間スキル報告書WEB化PJT固有のルール
- **02-04**: 技術スタック非依存の開発ガイドライン
- **05-07**: プロジェクト特化の運用・品質管理ガイドライン

## プロジェクト基本情報

### プロジェクト概要
- **プロジェクト名**: 年間スキル報告書WEB化PJT - マルチテナント対応
- **目的**: AI駆動開発の知見獲得 + 業務効率化・可視化の実現
- **技術スタック**: Next.js 14 + TypeScript + React 18 + Tailwind CSS + PostgreSQL + Vercel
- **開発期間**: 2025年5月開始（7週間での完成を重視）

### 開発体制
- **責任者**: 黒澤 (@yusuke-kurosawa)
- **PM**: 中島 (@SAS-nakajima)  
- **PL**: 笹尾 (@SAS-sasao)

## 重要な基本方針

### 1. 仕様書準拠の強制
- **docs/配下の仕様書が唯一の真実**: 全実装はdocs/配下の設計書に従う
- **破壊的修正の禁止**: 既存機能の破壊的変更は原則禁止
- **要求仕様ID必須**: 全実装で要求仕様IDの明記を必須とする
- **影響範囲調査**: 修正前に必ず影響範囲を調査・報告

### 2. マルチテナント対応の徹底
- **テナントID必須**: 全データアクセスでテナントIDを必須とする
- **データ分離**: テナント間の完全なデータ分離
- **UI分離**: テナント別のカラーテーマ・ロゴ設定
- **通知分離**: テナント別の通知設定・連携サービス

### 3. Git・バージョン管理の統制
- **要求仕様ID連携**: 全ブランチ・コミット・PRで要求仕様IDを必須
- **Gitflow戦略**: main/develop/feature/release/hotfixの厳格な運用
- **コードレビュー**: 全変更でレビューと承認を必須

## 要求仕様ID体系

### カテゴリ分類
- **TNT**: Multi-Tenant (マルチテナント基盤要件)
- **PLT**: Platform (システム基盤要件)
- **ACC**: Access Control (ユーザー権限管理)
- **PRO**: Profile (個人プロフィール管理)
- **SKL**: Skill (スキル情報管理)
- **CAR**: Career (目標・キャリア管理)
- **WPM**: Work Performance Mgmt (作業実績管理)
- **TRN**: Training (研修・セミナー管理)
- **RPT**: Report (レポート出力)
- **NTF**: Notification (通知・連携サービス)

### 実装優先順序
1. **Phase 1**: 最高優先度（TNT.1-MGMT, PLT.1-WEB.1, PRO.1-BASE.1, SKL.1-HIER.1）
2. **Phase 2**: 高優先度（認証・権限、スキル検索、マルチテナント認証）
3. **Phase 3**: 中優先度（目標管理、作業実績、研修管理）
4. **Phase 4**: 低優先度（レポート出力、分析機能）

## 技術スタック特化ルール

### Next.js 14 + App Router
- **App Router必須**: Pages Routerは使用禁止
- **Server Actions活用**: フォーム処理・データ更新はServer Actions優先
- **API Routes**: 外部連携・複雑なロジックのみAPI Routes使用
- **TypeScript厳密モード**: strict: true, noImplicitAny: true必須

### PostgreSQL + Prisma
- **Prisma必須**: 生SQLは特別な場合のみ許可
- **マルチテナント対応**: 全テーブルにtenant_idカラム必須
- **型安全性**: Prisma Clientの型を活用

### データベース設計・テーブル定義書作成ツール
- **YAML詳細定義必須**: 全テーブルでtable-details/{テーブル名}_details.yaml作成必須
- **自動生成ツール必須**: `python3 -m table_generator`による定義書・DDL・サンプルデータ生成
- **整合性チェック必須**: `python run_check.py`による品質保証を必須実行
- **命名規則厳守**: MST_, TRN_, HIS_, SYS_, WRK_プレフィックスによるカテゴリ分類

### Vercel環境最適化
- **Vercel Cron Jobs**: バッチ処理はVercel Cron Jobs使用
- **Edge Functions**: 可能な限りEdge Runtime使用
- **環境変数**: Vercel環境変数による設定管理

## 開発・実装の必須事項

### コード作成時の必須事項
1. **要求仕様IDの明記**: 全実装に対応する要求仕様IDをコメントで記載
2. **設計書との整合性**: 画面・API・DB設計書との一致を確認
3. **TypeScript型安全性**: 厳密な型定義を必須とする
4. **マルチテナント対応**: 全機能でテナント分離を実装
5. **レスポンシブ対応**: 全画面でマルチデバイス対応を実装

### 非機能要件の必須実装
- **パフォーマンス**: API〜UI まで1秒以内
- **アクセシビリティ**: WCAG 2.1 AA準拠
- **セキュリティ**: AES-256暗号化、TLS必須
- **監査証跡**: 90日間ログ保持
- **マルチテナント分離**: テナント間データアクセス防止

## AI駆動開発の基本方針

### AI活用必須領域
1. **コード生成**: 定型的なCRUD操作、バリデーション
2. **テスト生成**: ユニット・統合・E2Eテストケース
3. **ドキュメント生成**: API仕様書、コメント
4. **設計支援**: アーキテクチャ提案、技術選定

### 技術選定・変更管理
- **技術スタック非依存**: 要件に基づいた最適な技術選定
- **APIファーストアプローチ**: フロントエンド・バックエンド分離設計
- **技術スタック変更時**: 必ずユーザーに確認・承認を得てから実施

## 品質保証・成功指標

### 品質ゲート
- **テストカバレッジ**: 80%以上を維持
- **静的解析**: 重大な問題0件
- **セキュリティ**: 脆弱性スキャン通過
- **パフォーマンス**: レスポンス時間1秒以内
- **マルチテナント**: テナント間データ漏洩0件
- **DB設計品質**: 整合性チェック通過率100%、要求仕様ID対応率100%、命名規則準拠率100%

### 成功指標（KPI）
- **開発効率**: AI活用率、開発速度、品質指標
- **業務改善**: 作業時間50%削減、エラー70%削減、利用率90%以上
- **システム品質**: 可用性99.5%以上、レスポンス時間1秒以内95%達成
- **マルチテナント**: テナント追加時間24時間以内

## 必須確認事項・禁止事項

### 必須確認事項
1. **要求仕様ID**: 全実装で対応IDを明確化
2. **設計書整合性**: 画面・API・DB設計の一貫性
3. **非機能要件**: パフォーマンス・セキュリティ・アクセシビリティ
4. **マルチテナント対応**: テナント分離の実装確認
5. **DB設計品質**: YAML詳細定義作成、自動生成ツール使用、整合性チェック実行

### 禁止事項
- 要求仕様IDなしの実装
- 設計書との不整合
- 非機能要件の未実装
- マルチテナント分離の未実装
- Pages Routerの使用
- 破壊的変更の無承認実行
- **DB設計関連禁止事項**:
  - YAML詳細定義なしのテーブル作成
  - 手動DDL作成（自動生成ツール使用必須）
  - 整合性チェック未実行でのコミット
  - 命名規則違反のテーブル・カラム名

## 詳細ガイドライン参照

各分野の詳細なガイドラインは以下のファイルを参照してください：

- **プロジェクト固有ルール**: `01-project-specific-rules.md`
- **コーディング規約**: `02-coding-standards.md`
- **フロントエンド設計**: `03-frontend-guidelines.md`
- **バックエンド設計**: `04-backend-guidelines.md`
- **Git・バージョン管理**: `05-git-workflow.md`
- **マルチテナント開発**: `06-multitenant-development.md`
- **仕様書準拠・破壊的修正防止**: `07-specification-compliance.md`
- **データベース設計**: `08-database-design-guidelines.md`

---

この統合ルールと各詳細ガイドラインに従って、年間スキル報告書WEB化PJTの開発を効率的かつ高品質に進めてください。
