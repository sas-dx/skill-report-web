# システムパターン: 年間スキル報告書WEB化

## システムアーキテクチャ概要

本プロジェクトでは、モダンなWeb技術を活用した、スケーラブルで保守性の高いアーキテクチャを採用します。要件定義書の作成と詳細化を進める中で、要件に最適なアーキテクチャの設計を行っています。現時点では技術スタックは検討中ですが、以下の基本構造を想定しています。

```
                  ┌─────────────────┐
                  │    クライアント    │
                  │  (Webブラウザ)   │
                  └────────┬────────┘
                           │
                           ▼
┌─────────────────────────────────────────────────┐
│              フロントエンドアプリケーション            │
│  (React/Vue.js等のSPAフレームワークを検討中)       │
└────────────────────────┬────────────────────────┘
                         │
                         ▼
┌─────────────────────────────────────────────────┐
│                   APIレイヤー                    │
│         (RESTful API または GraphQL)           │
└────────────────────────┬────────────────────────┘
                         │
                         ▼
┌─────────────────────────────────────────────────┐
│               バックエンドサービス                 │
│      (Node.js/Express, Spring Boot等を検討中)    │
└────────────────────────┬────────────────────────┘
                         │
                         ▼
┌─────────────────────────────────────────────────┐
│                 データストア                     │
│        (RDBMSまたはNoSQLを用途に応じて検討)       │
└─────────────────────────────────────────────────┘
```

### 要件定義書に基づく設計方針

要件定義書の作成と詳細化を進める中で、以下の設計方針を採用しています：

1. **ユーザー中心設計**
   - 3ステップ以内に目的の画面へ到達できるナビゲーション設計
   - 直感的なUI/UXの実現
   - アクセシビリティ要件（WCAG 2.1 AA相当）の達成

2. **パフォーマンス最適化**
   - API〜UIまでのレスポンスを1秒以内に保つアーキテクチャ
   - データ取得の効率化（必要なデータのみを取得）
   - クライアントサイドのレンダリング最適化

3. **拡張性と保守性**
   - 機能追加や変更に柔軟に対応できるモジュラー設計
   - 明確な責務分離によるコードの可読性と保守性の向上
   - 再利用可能なコンポーネントの活用

## 主要コンポーネント構成

### 1. フロントエンドアプリケーション

フロントエンドは、要件定義書に基づき、以下のコンポーネント構成を予定しています：

- **認証モジュール**: ユーザー認証と権限管理（FR-01: ログイン画面）
- **ダッシュボードコンポーネント**: データ可視化と概要表示（FR-02: ダッシュボード）
- **スキル入力フォーム**: インタラクティブなデータ入力UI（FR-03: スキル入力画面）
- **レポート生成モジュール**: データ集計と表示
- **設定・管理画面**: ユーザー設定と管理機能

### 2. バックエンドサービス

バックエンドは、要件定義書に基づき、以下の責務を持つサービスで構成します：

- **認証サービス**: ユーザー認証と認可（SSO またはダミーユーザー認証）
- **スキルデータサービス**: スキル情報の管理
- **レポートサービス**: データ集計と分析
- **通知サービス**: メール通知等のコミュニケーション
- **管理サービス**: システム設定と管理機能

### 3. データモデル（仮）

現時点で想定されるコアデータモデルは以下の通りです。要件定義書の詳細化に伴い、さらに精緻化する予定です：

```
┌───────────────┐      ┌───────────────┐      ┌───────────────┐
│     User      │      │  SkillReport   │      │  SkillItem    │
├───────────────┤      ├───────────────┤      ├───────────────┤
│ id            │──┐   │ id            │──┐   │ id            │
│ name          │  │   │ userId        │◄─┘   │ reportId      │◄─┐
│ email         │  │   │ year          │      │ skillName     │  │
│ department    │  └──►│ quarter       │      │ category      │  │
│ role          │      │ status        │      │ level         │  │
│ manager       │      │ createdAt     │      │ target        │  │
└───────────────┘      │ updatedAt     │      │ comments      │  │
                       └───────┬───────┘      └───────────────┘  │
                               │                                 │
                               └─────────────────────────────────┘
```

### 4. 画面遷移図（仮）

要件定義書に基づく画面遷移の概要は以下の通りです：

```
┌───────────────┐     ┌───────────────┐     ┌───────────────┐
│               │     │               │     │               │
│  ログイン画面   │────►│ ダッシュボード  │────►│ スキル入力画面 │
│   (FR-01)     │     │   (FR-02)     │     │   (FR-03)     │
│               │     │               │     │               │
└───────────────┘     └───────┬───────┘     └───────────────┘
                              │
                              ▼
                     ┌───────────────┐
                     │               │
                     │ レポート画面   │
                     │               │
                     │               │
                     └───────────────┘
```

## 設計パターンと原則

本プロジェクトでは、要件定義書に基づき、以下の設計パターンと原則を採用する予定です：

### アーキテクチャパターン

1. **クリーンアーキテクチャ / ヘキサゴナルアーキテクチャ**
   - ビジネスロジックを中心に据え、外部依存を最小化
   - ドメインロジックとインフラストラクチャの分離
   - 要件定義書の機能要件の実装を容易にする構造

2. **マイクロサービスアーキテクチャ（検討中）**
   - 機能ごとに独立したサービスとして実装
   - スケーラビリティと保守性の向上
   - 要件定義書の非機能要件（パフォーマンス）達成のための分散処理

### デザインパターン

1. **リポジトリパターン**
   - データアクセスロジックの抽象化
   - テスト容易性の向上
   - 要件定義書のデータ管理要件の実装を容易に

2. **ファクトリーパターン**
   - オブジェクト生成ロジックの集約
   - 依存性の制御
   - 要件定義書の拡張性要件への対応

3. **オブザーバーパターン**
   - イベント駆動型の通知システム
   - コンポーネント間の疎結合維持
   - 要件定義書の通知要件の実装

4. **コマンド/クエリ責務分離（CQRS）**
   - データ更新と参照の分離
   - パフォーマンスと拡張性の向上
   - 要件定義書の非機能要件（パフォーマンス）達成

## データフロー

### 主要なデータフロー

要件定義書に基づく主要なデータフローは以下の通りです：

1. **スキル入力フロー** (FR-03: スキル入力画面)
   ```
   ユーザー → スキル入力フォーム → バリデーション → APIリクエスト → 
   バックエンド処理 → データベース保存 → 確認レスポンス → UI更新
   ```

2. **ダッシュボード表示フロー** (FR-02: ダッシュボード)
   ```
   ユーザー → ダッシュボード要求 → APIリクエスト → データ取得 → 
   集計処理 → レスポンス → データ可視化 → UI表示
   ```

3. **レポート生成フロー**
   ```
   ユーザー → レポート要求 → パラメータ設定 → APIリクエスト → 
   データ取得 → 集計・分析 → レポート生成 → ダウンロード/表示
   ```

4. **認証フロー** (FR-01: ログイン画面)
   ```
   ユーザー → ログイン情報入力 → 認証リクエスト → 認証処理 → 
   トークン生成 → セッション確立 → ダッシュボードへリダイレクト
   ```

## セキュリティ設計

要件定義書に基づくセキュリティ設計は以下の通りです：

1. **認証・認可** (FR-01: ログイン画面)
   - JWTベースの認証（検討中）
   - ロールベースのアクセス制御
   - セッション管理
   - SSO または独自認証の実装

2. **データ保護**
   - 転送中の暗号化（HTTPS）
   - 保存データの暗号化（必要に応じて）
   - 入力検証とサニタイズ
   - センシティブデータの保護

3. **監査とログ**
   - セキュリティイベントのログ記録
   - ユーザーアクションの監査証跡
   - 異常検知メカニズム
   - アクセスログの保存と分析

## スケーラビリティ考慮事項

要件定義書の非機能要件（NFR-01: パフォーマンス）を達成するためのスケーラビリティ考慮事項：

1. **水平スケーリング**
   - ステートレスなサービス設計
   - ロードバランシング対応
   - コンテナ化によるスケールアウト容易性

2. **キャッシュ戦略**
   - 頻繁にアクセスされるデータのキャッシュ
   - 分散キャッシュの検討
   - クライアントサイドキャッシュの活用

3. **非同期処理**
   - 長時間実行タスクの非同期化
   - メッセージキューの活用（必要に応じて）
   - バックグラウンド処理の最適化

## アクセシビリティ設計

要件定義書の非機能要件（NFR-02: アクセシビリティ）を達成するための設計：

1. **WCAG 2.1 AA準拠**
   - 適切なコントラスト比
   - キーボード操作のサポート
   - スクリーンリーダー対応
   - フォーカス可視化

2. **アクセシブルコンポーネント**
   - セマンティックHTML
   - ARIA属性の適切な使用
   - フォーム要素のラベル付け
   - エラーメッセージの明示

3. **レスポンシブデザイン**
   - 様々な画面サイズへの対応
   - タッチデバイスのサポート
   - 拡大表示への対応

## プロジェクトディレクトリ構成

### 2025年5月29日更新: 体系化されたドキュメント構造

プロジェクトは以下の体系的なディレクトリ構成で管理されています：

```
skill-report-web/
├── .clinerules/                    # 開発ガイドライン
│   ├── 01-project-context.md       # プロジェクト基本情報・方針
│   ├── 02-coding-standards.md      # コーディング規約
│   ├── 03-frontend-guidelines.md   # フロントエンド設計ガイドライン
│   ├── 04-backend-guidelines.md    # バックエンド設計ガイドライン
│   ├── 05-requirements-analysis.md # 要件分析・設計ガイドライン
│   ├── 06-development-workflow.md  # 開発ワークフロー・プロセス管理
│   ├── 07-testing-strategy.md      # テスト戦略・品質保証
│   └── 08-ai-driven-development.md # AI駆動開発ガイドライン
│
├── memory-bank/                    # プロジェクト記憶システム
│   ├── projectbrief.md            # プロジェクト概要
│   ├── productContext.md          # 製品コンテキスト
│   ├── activeContext.md           # 現在の作業状況
│   ├── systemPatterns.md          # システムパターン（本ファイル）
│   ├── techContext.md             # 技術コンテキスト
│   └── progress.md                 # 進捗状況
│
├── docs/                          # プロジェクトドキュメント
│   ├── requirements/              # 要件定義関連
│   │   ├── 要件定義.md
│   │   ├── 技術スタック選定.md
│   │   └── プロジェクト基本情報_改訂版.md
│   │
│   ├── design/                    # 設計書
│   │   ├── database/              # データベース設計
│   │   │   ├── テーブル一覧.md
│   │   │   ├── エンティティ関連図.md
│   │   │   └── tables/            # 個別テーブル定義書（25ファイル）
│   │   │
│   │   ├── api/                   # API設計
│   │   │   ├── API一覧.md
│   │   │   └── specs/             # 個別API仕様書（41ファイル）
│   │   │
│   │   ├── screens/               # 画面設計
│   │   │   ├── 画面一覧.md
│   │   │   └── specs/             # 個別画面設計書（15ファイル）
│   │   │
│   │   ├── batch/                 # バッチ処理設計
│   │   │   ├── バッチ一覧.md
│   │   │   └── specs/             # 個別バッチ仕様書（17ファイル）
│   │   │
│   │   └── interfaces/            # インターフェース設計
│   │       ├── インターフェース一覧.md
│   │       └── specs/             # 個別インターフェース仕様書（1ファイル）
│   │
│   └── testing/                   # テスト関連
│       ├── テスト計画書.md
│       ├── 機能テスト実行計画書.md
│       ├── E2Eテスト実行手順書.md
│       ├── ユニットテスト実装ガイド.md
│       └── ユニットテスト実装ガイド_続き.md
│
├── README.md                      # プロジェクト概要
├── .gitignore                     # Git除外設定
└── 要件定義.md                    # ルートレベル要件定義（移行予定）
```

### ドキュメント参照パターン

開発時は以下のパターンでドキュメントを参照します：

1. **開発開始前の必読ドキュメント**
   ```
   .clinerules/ → memory-bank/ → docs/requirements/ → docs/design/
   ```

2. **機能実装時の参照順序**
   ```
   要求仕様ID確認 → docs/design/screens/ → docs/design/api/ → docs/design/database/
   ```

3. **テスト実装時の参照順序**
   ```
   docs/testing/ → docs/design/api/ → .clinerules/07-testing-strategy.md
   ```

### ドキュメント管理ルール

- **一覧ファイル**: 各設計領域の概要とナビゲーション
- **specs/ディレクトリ**: 個別仕様書の詳細定義
- **相互参照**: ドキュメント間のリンクで関連情報へのナビゲーション
- **バージョン管理**: Git履歴による変更追跡

## 注意事項

現時点ではアーキテクチャと設計パターンは検討段階であり、要件定義書の完成と技術スタック確定後に詳細化・最適化を行う予定です。特に以下の点については、要件定義書の内容と選定される技術に応じて再検討します：

- データベース設計（RDBMSかNoSQLか）
- APIデザイン（RESTかGraphQLか）
- フロントエンドフレームワークの選定
- デプロイメント戦略
- パフォーマンス最適化手法

### ドキュメント構造の活用方針

体系化されたドキュメント構造により、以下の効果を期待します：

1. **開発効率向上**: 必要な情報への迅速なアクセス
2. **品質保証**: 設計書に基づく一貫した実装
3. **チーム協力**: 役割分担に応じた適切なドキュメント参照
4. **保守性向上**: 関連ドキュメントの一元管理
